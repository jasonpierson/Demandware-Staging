<?xml version="1.0" encoding="UTF-8" ?>
<?demandware-pipeline version="2.0"?>

<pipeline group="Checkout">
  <branch basename="_ANONYMOUS_BRANCH_1">
    <segment>
      <node>
        <text-node>
          <description>Renders the basket content.</description>
        </text-node>
        <node-display x="3" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="Show">
    <segment>
      <node>
        <start-node name="Show" secure="false"/>
        <node-display x="3" y="2"/>
      </node>
      <simple-transition/>
      <node>
        <pipelet-node pipelet-name="ClearFormElement" pipelet-set-identifier="bc_api">
          <key-binding alias="CurrentForms.cart.shipments" key="FormElement"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
      </node>
      <simple-transition/>
      <node>
        <pipelet-node pipelet-name="ClearFormElement" pipelet-set-identifier="bc_api">
          <key-binding alias="CurrentForms.login" key="FormElement"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
      </node>
      <simple-transition/>
      <node>
        <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
          <key-binding alias="null" key="From_0"/>
          <key-binding alias="CouponStatus" key="To_0"/>
          <key-binding alias="null" key="From_1"/>
          <key-binding alias="null" key="To_1"/>
          <key-binding alias="null" key="From_2"/>
          <key-binding alias="null" key="To_2"/>
          <key-binding alias="null" key="From_3"/>
          <key-binding alias="null" key="To_3"/>
          <key-binding alias="null" key="From_4"/>
          <key-binding alias="null" key="To_4"/>
          <key-binding alias="null" key="From_5"/>
          <key-binding alias="null" key="To_5"/>
          <key-binding alias="null" key="From_6"/>
          <key-binding alias="null" key="To_6"/>
          <key-binding alias="null" key="From_7"/>
          <key-binding alias="null" key="To_7"/>
          <key-binding alias="null" key="From_8"/>
          <key-binding alias="null" key="To_8"/>
          <key-binding alias="null" key="From_9"/>
          <key-binding alias="null" key="To_9"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
      </node>
      <simple-transition/>
      <node>
        <call-node start-name-ref="Cart-GetExistingBasket"/>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in2" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="1"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <call-node start-name-ref="Cart-PrepareView"/>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="1"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <interaction-continue-node secure="false" start-name="SubmitForm1" transaction-required="false">
          <template buffered="true" dynamic="false" name="checkout/cart/cart"/>
        </interaction-continue-node>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="addCoupon">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="target" x="0" y="-1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <decision-node condition-key="!empty(CurrentForms.cart.couponCode.value)" condition-operator="expr"/>
              <node-display x="3" y="6"/>
              <branch basename="b2" source-connector="yes">
                <transition target-connector="in">
                  <transition-display>
                    <bend-point relative-to="source" x="0" y="1"/>
                  </transition-display>
                </transition>
                <segment>
                  <node>
                    <pipelet-node pipelet-name="AddCouponToBasket2" pipelet-set-identifier="bc_api">
                      <key-binding alias="Basket" key="Basket"/>
                      <key-binding alias="CurrentForms.cart.couponCode.htmlValue" key="CouponCode"/>
                      <key-binding alias="CouponStatus" key="Status"/>
                      <key-binding alias="null" key="CouponLineItem"/>
                    </pipelet-node>
                    <node-display x="0" y="1"/>
                    <branch basename="b2" source-connector="error">
                      <transition target-connector="in2" target-path="../+1"/>
                    </branch>
                  </node>
                  <simple-transition>
                    <transition-display>
                      <bend-point relative-to="source" x="0" y="1"/>
                    </transition-display>
                  </simple-transition>
                  <node>
                    <call-node start-name-ref="Cart-Calculate"/>
                    <node-display x="0" y="1"/>
                  </node>
                  <transition target-connector="in1" target-path="./+1"/>
                </segment>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="0" y="1"/>
                  </node>
                  <transition target-connector="in1" target-path="../+2"/>
                </segment>
              </branch>
            </node>
            <transition target-connector="in1" target-path="./+1">
              <transition-display>
                <bend-point relative-to="source" x="2" y="0"/>
              </transition-display>
            </transition>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="1" y="1"/>
            </node>
            <transition target-connector="in1" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="0" y="2"/>
            </node>
            <transition target-connector="in1" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="1" y="2"/>
            </node>
            <transition target-connector="in1" target-path="./+1">
              <transition-display>
                <bend-point relative-to="source" x="4" y="0"/>
              </transition-display>
            </transition>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="2" y="-4"/>
            </node>
            <transition target-connector="in1" target-path="../+1"/>
          </segment>
        </branch>
        <branch basename="b3" source-connector="addQuickProduct">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="target" x="0" y="-1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="false"/>
                <key-binding alias="null" key="From_0"/>
                <key-binding alias="quickAddStatus" key="To_0"/>
                <key-binding alias="null" key="From_1"/>
                <key-binding alias="null" key="To_1"/>
                <key-binding alias="null" key="From_2"/>
                <key-binding alias="null" key="To_2"/>
                <key-binding alias="null" key="From_3"/>
                <key-binding alias="null" key="To_3"/>
                <key-binding alias="null" key="From_4"/>
                <key-binding alias="null" key="To_4"/>
                <key-binding alias="null" key="From_5"/>
                <key-binding alias="null" key="To_5"/>
                <key-binding alias="null" key="From_6"/>
                <key-binding alias="null" key="To_6"/>
                <key-binding alias="null" key="From_7"/>
                <key-binding alias="null" key="To_7"/>
                <key-binding alias="null" key="From_8"/>
                <key-binding alias="null" key="To_8"/>
                <key-binding alias="null" key="From_9"/>
                <key-binding alias="null" key="To_9"/>
              </pipelet-node>
              <node-display x="5" y="6"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <call-node start-name-ref="Cart-QuickAdd"/>
              <node-display x="0" y="1"/>
            </node>
            <transition target-connector="in1" target-path="../b2.4"/>
          </segment>
        </branch>
        <branch basename="b4" source-connector="calculateTotal">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="target" x="0" y="-3"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <call-node start-name-ref="Cart-Calculate"/>
              <node-display x="2" y="7"/>
            </node>
            <transition target-connector="in1" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="0" y="2"/>
            </node>
            <transition target-connector="in2" target-path="../b2.1/b2.2"/>
          </segment>
        </branch>
        <branch basename="b5" source-connector="checkoutCart">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="target" x="0" y="-1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <call-node start-name-ref="Cart-COStart"/>
              <node-display x="6" y="6"/>
              <branch basename="b2" source-connector="error">
                <transition target-connector="in1" target-path="../b2.5">
                  <transition-display>
                    <bend-point relative-to="source" x="0" y="2"/>
                  </transition-display>
                </transition>
              </branch>
            </node>
          </segment>
        </branch>
        <branch basename="b6" source-connector="continueShopping">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="-5" y="11"/>
              <bend-point relative-to="target" x="-1" y="-6"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <jump-node start-name-ref="Cart-ContinueShopping"/>
              <node-display x="-2" y="13"/>
            </node>
          </segment>
        </branch>
        <branch basename="b7" source-connector="deleteCoupon">
          <transition target-connector="in"/>
          <segment>
            <node>
              <pipelet-node pipelet-name="RemoveCouponLineItem" pipelet-set-identifier="bc_api">
                <key-binding alias="TriggeredAction.object" key="CouponLineItem"/>
              </pipelet-node>
              <node-display x="0" y="6"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <call-node start-name-ref="Cart-Calculate"/>
              <node-display x="0" y="1"/>
            </node>
            <transition target-connector="in1" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="0" y="5"/>
            </node>
            <transition target-connector="in1" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="1" y="0"/>
            </node>
            <transition target-connector="in1" target-path="../b4.2">
              <transition-display>
                <bend-point relative-to="source" x="2" y="0"/>
              </transition-display>
            </transition>
          </segment>
        </branch>
        <branch basename="b8" source-connector="deleteGiftCertificate">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="target" x="0" y="-1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <pipelet-node pipelet-name="RemoveGiftCertificateLineItem" pipelet-set-identifier="bc_api">
                <key-binding alias="TriggeredAction.object" key="GiftCertificateLineItem"/>
              </pipelet-node>
              <node-display x="-2" y="6"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <call-node start-name-ref="Cart-Calculate"/>
              <node-display x="0" y="1"/>
            </node>
            <transition target-connector="in1" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="0" y="5"/>
            </node>
            <transition target-connector="in1" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="1" y="0"/>
            </node>
            <transition target-connector="in1" target-path="../b7.2"/>
          </segment>
        </branch>
        <branch basename="b9" source-connector="deleteProduct">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="target" x="0" y="-1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <pipelet-node pipelet-name="RemoveProductLineItem" pipelet-set-identifier="bc_api">
                <key-binding alias="TriggeredAction.object" key="ProductLineItem"/>
              </pipelet-node>
              <node-display x="-1" y="6"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <call-node start-name-ref="Cart-Calculate"/>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <decision-node condition-key="!empty(TriggeredAction.object.product.custom.ProductType) &amp;&amp; TriggeredAction.object.product.custom.ProductType=='RewardsRedeemable' &amp;&amp; dw.system.Site.getCurrent().getCustomPreferenceValue('ChurchRewardsProgramActive')" condition-operator="expr"/>
              <node-display x="0" y="1"/>
              <branch basename="b2" source-connector="yes">
                <transition target-connector="in">
                  <transition-display>
                    <bend-point relative-to="source" x="0" y="1"/>
                  </transition-display>
                </transition>
                <segment>
                  <node>
                    <call-node start-name-ref="Cart-QuickRemoveChurchRewardsPoints"/>
                    <node-display x="0" y="1"/>
                  </node>
                  <transition target-connector="in1" target-path="../+1"/>
                </segment>
              </branch>
            </node>
            <transition target-connector="in1" target-path="./+1">
              <transition-display>
                <bend-point relative-to="source" x="1" y="0"/>
                <bend-point relative-to="target" x="1" y="0"/>
              </transition-display>
            </transition>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="0" y="2"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="false"/>
                <key-binding alias="updatePointsError" key="From_0"/>
                <key-binding alias="quickAddStatus" key="To_0"/>
                <key-binding alias="null" key="From_1"/>
                <key-binding alias="null" key="To_1"/>
                <key-binding alias="null" key="From_2"/>
                <key-binding alias="null" key="To_2"/>
                <key-binding alias="null" key="From_3"/>
                <key-binding alias="null" key="To_3"/>
                <key-binding alias="null" key="From_4"/>
                <key-binding alias="null" key="To_4"/>
                <key-binding alias="null" key="From_5"/>
                <key-binding alias="null" key="To_5"/>
                <key-binding alias="null" key="From_6"/>
                <key-binding alias="null" key="To_6"/>
                <key-binding alias="null" key="From_7"/>
                <key-binding alias="null" key="To_7"/>
                <key-binding alias="null" key="From_8"/>
                <key-binding alias="null" key="To_8"/>
                <key-binding alias="null" key="From_9"/>
                <key-binding alias="null" key="To_9"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
            </node>
            <transition target-connector="in1" target-path="../b8.3"/>
          </segment>
        </branch>
        <branch basename="b10" source-connector="editLineItem">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="target" x="0" y="-1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <call-node start-name-ref="Cart-EditLineItem"/>
              <node-display x="1" y="13"/>
              <branch basename="b2" source-connector="error">
                <transition target-connector="in1"/>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="0" y="2"/>
                  </node>
                  <simple-transition>
                    <transition-display>
                      <bend-point relative-to="source" x="0" y="1"/>
                    </transition-display>
                  </simple-transition>
                  <node>
                    <call-node start-name-ref="Cart-Calculate"/>
                    <node-display x="0" y="1"/>
                  </node>
                  <transition target-connector="in1" target-path="./+1">
                    <transition-display>
                      <bend-point relative-to="source" x="3" y="1"/>
                    </transition-display>
                  </transition>
                </segment>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="3" y="0"/>
                  </node>
                  <transition target-connector="in1" target-path="../../b2.4">
                    <transition-display>
                      <bend-point relative-to="source" x="2" y="0"/>
                    </transition-display>
                  </transition>
                </segment>
              </branch>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="target" x="0" y="-1"/>
              </transition-display>
            </simple-transition>
            <node>
              <call-node start-name-ref="Cart-Calculate"/>
              <node-display x="1" y="2"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <interaction-node transaction-required="false">
                <template buffered="true" dynamic="false" name="checkout/cart/refreshcart"/>
              </interaction-node>
              <node-display x="0" y="1"/>
            </node>
          </segment>
        </branch>
        <branch basename="b11" source-connector="login">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="-1" y="11"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <call-node start-name-ref="Login-Process"/>
              <node-display x="0" y="13"/>
              <branch basename="b2" source-connector="login_failed">
                <transition target-connector="in1" target-path="../b10.1/b2.1"/>
              </branch>
              <branch basename="b3" source-connector="login_succeeded">
                <transition target-connector="in">
                  <transition-display>
                    <bend-point relative-to="target" x="0" y="-1"/>
                  </transition-display>
                </transition>
                <segment>
                  <node>
                    <pipelet-node pipelet-name="GetBasket" pipelet-set-identifier="bc_api">
                      <description>Call GetBasket here because the current Basket in session is disconnected from the newly logged in customer.</description>
                      <config-property key="Create" value="true"/>
                      <key-binding alias="Basket" key="Basket"/>
                      <key-binding alias="StoredBasket" key="StoredBasket"/>
                    </pipelet-node>
                    <node-display x="-1" y="1"/>
                  </node>
                  <simple-transition>
                    <transition-display>
                      <bend-point relative-to="source" x="0" y="1"/>
                    </transition-display>
                  </simple-transition>
                  <node>
                    <call-node start-name-ref="Cart-COStart"/>
                    <node-display x="0" y="1"/>
                    <branch basename="b2" source-connector="error">
                      <transition target-connector="in1" target-path="../../b10.1/b2.1"/>
                    </branch>
                  </node>
                </segment>
              </branch>
            </node>
          </segment>
        </branch>
        <branch basename="b12" source-connector="logout">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="-3" y="11"/>
              <bend-point relative-to="target" x="-1" y="-6"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <jump-node start-name-ref="Login-Logout"/>
              <node-display x="-1" y="13"/>
            </node>
          </segment>
        </branch>
        <branch basename="b13" source-connector="register">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="7" y="11"/>
              <bend-point relative-to="target" x="-1" y="-8"/>
              <bend-point relative-to="target" x="0" y="-1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <call-node start-name-ref="Account-Register"/>
              <node-display x="4" y="14"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <call-node start-name-ref="Cart-Calculate"/>
              <node-display x="0" y="1"/>
            </node>
            <transition target-connector="in2" target-path="../b10.1/b2.2"/>
          </segment>
        </branch>
        <branch basename="b14" source-connector="unregistered">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="5" y="11"/>
              <bend-point relative-to="target" x="-1" y="-8"/>
              <bend-point relative-to="target" x="0" y="-1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <jump-node start-name-ref="COShipping-Start"/>
              <node-display x="3" y="14"/>
            </node>
          </segment>
        </branch>
        <branch basename="b15" source-connector="updateCart">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="target" x="0" y="-1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <pipelet-node pipelet-name="Script" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="true"/>
                <config-property key="OnError" value="PIPELET_ERROR"/>
                <config-property key="ScriptFile" value="cart/RemoveZeroQuantityLineItems.ds"/>
                <key-binding alias="Basket" key="Basket"/>
                <key-binding alias="CurrentForms.cart" key="ShipmentsForm"/>
              </pipelet-node>
              <node-display x="1" y="6"/>
              <branch basename="b2" source-connector="error">
                <transition target-connector="in1" target-path="../b4.2"/>
              </branch>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <pipelet-node custom-name="Update line item quantities" pipelet-name="AcceptForm" pipelet-set-identifier="bc_api">
                <description>Need to use this pipelet instead of UpdateObjectFromForm since the latter one doesn't support recursive lists yet.</description>
                <key-binding alias="CurrentForms.cart.shipments" key="Form"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <call-node start-name-ref="Cart-Calculate"/>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="false"/>
                <key-binding alias="updatePointsError" key="From_0"/>
                <key-binding alias="quickAddStatus" key="To_0"/>
                <key-binding alias="null" key="From_1"/>
                <key-binding alias="null" key="To_1"/>
                <key-binding alias="null" key="From_2"/>
                <key-binding alias="null" key="To_2"/>
                <key-binding alias="null" key="From_3"/>
                <key-binding alias="null" key="To_3"/>
                <key-binding alias="null" key="From_4"/>
                <key-binding alias="null" key="To_4"/>
                <key-binding alias="null" key="From_5"/>
                <key-binding alias="null" key="To_5"/>
                <key-binding alias="null" key="From_6"/>
                <key-binding alias="null" key="To_6"/>
                <key-binding alias="null" key="From_7"/>
                <key-binding alias="null" key="To_7"/>
                <key-binding alias="null" key="From_8"/>
                <key-binding alias="null" key="To_8"/>
                <key-binding alias="null" key="From_9"/>
                <key-binding alias="null" key="To_9"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
            </node>
            <transition target-connector="in1" target-path="../b7.3"/>
          </segment>
        </branch>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="7" y="4"/>
      </node>
      <transition target-connector="in1" target-path="./-2"/>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_3">
    <segment>
      <node>
        <text-node>
          <description>Redirects the user to the last visited catalog URL as implemented in the custom script.</description>
        </text-node>
        <node-display x="8" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_4">
    <segment>
      <node>
        <text-node>
          <description>Removes an existing product line item and adds a new one with options, variations and new quantity.
params:
just like miniaddproduct i.e. pid, options, quantiy.</description>
        </text-node>
        <node-display width="2" x="11" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="ContinueShopping">
    <segment>
      <node>
        <start-node name="ContinueShopping" secure="false"/>
        <node-display x="8" y="2"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <pipelet-node pipelet-name="Script" pipelet-set-identifier="bc_api">
          <config-property key="ScriptFile" value="cart/ContinueShopping.ds"/>
          <config-property key="Transactional" value="false"/>
          <key-binding alias="null" key="ScriptLog"/>
          <key-binding alias="Location" key="Location"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <interaction-node transaction-required="false">
          <template buffered="true" dynamic="false" name="util/redirect"/>
        </interaction-node>
        <node-display x="0" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="EditLineItem">
    <segment>
      <node>
        <start-node call-mode="private" name="EditLineItem" secure="false"/>
        <node-display x="11" y="2"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <pipelet-node pipelet-name="GetProduct" pipelet-set-identifier="bc_api">
          <key-binding alias="Product" key="Product"/>
          <key-binding alias="CurrentHttpParameterMap.pid.stringValue" key="ProductID"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="error">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="1" y="0"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <end-node name="error"/>
              <node-display orientation="horizontal" x="1" y="0"/>
            </node>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <pipelet-node pipelet-name="UpdateProductOptionSelections" pipelet-set-identifier="bc_api"/>
        <node-display x="0" y="1"/>
      </node>
      <simple-transition/>
      <node>
        <pipelet-node pipelet-name="RemoveProductLineItem" pipelet-set-identifier="bc_api">
          <key-binding alias="TriggeredAction.object" key="ProductLineItem"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
      </node>
      <simple-transition/>
      <node>
        <pipelet-node pipelet-name="AddProductToBasket" pipelet-set-identifier="bc_api">
          <key-binding alias="Basket" key="Basket"/>
          <key-binding alias="Product" key="Product"/>
          <key-binding alias="ProductOptionModel" key="ProductOptionModel"/>
          <key-binding alias="CurrentHttpParameterMap.Quantity.doubleValue" key="Quantity"/>
          <key-binding alias="null" key="Shipment"/>
          <key-binding alias="ProductLineItem" key="ProductLineItem"/>
          <key-binding alias="dw.catalog.CatalogMgr.getCategory(CurrentHttpParameterMap.cgid.value)" key="Category"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
        <branch basename="b3" source-connector="error">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="1" y="0"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <end-node name="error"/>
              <node-display orientation="horizontal" x="1" y="0"/>
            </node>
          </segment>
        </branch>
      </node>
      <simple-transition/>
      <node>
        <decision-node condition-key="Product.bundle" condition-operator="expr"/>
        <node-display x="0" y="1"/>
        <branch basename="b4" source-connector="yes">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="0" y="1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <call-node start-name-ref="Cart-ReplaceBundleLineItemProducts"/>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <end-node/>
              <node-display x="0" y="1"/>
            </node>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="1" y="0"/>
        </transition-display>
      </simple-transition>
      <node>
        <end-node/>
        <node-display orientation="horizontal" x="1" y="0"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_7">
    <segment>
      <node>
        <text-node>
          <description>Determines some needed objects based on the current form values.</description>
        </text-node>
        <node-display x="14" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="PrepareView">
    <segment>
      <node>
        <start-node call-mode="private" name="PrepareView" secure="false"/>
        <node-display x="14" y="2"/>
      </node>
      <simple-transition/>
      <node>
        <decision-node condition-key="Basket != null" condition-operator="expr"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="yes">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="0" y="1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <pipelet-node custom-name="Refresh Shipments" pipelet-name="UpdateFormWithObject" pipelet-set-identifier="bc_api">
                <key-binding alias="CurrentForms.cart.shipments" key="Form"/>
                <key-binding alias="Basket.shipments" key="Object"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <pipelet-node custom-name="RefreshCoupons" pipelet-name="UpdateFormWithObject" pipelet-set-identifier="bc_api">
                <config-property key="Clear" value="true"/>
                <key-binding alias="CurrentForms.cart.coupons" key="Form"/>
                <key-binding alias="Basket.couponLineItems" key="Object"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <pipelet-node pipelet-name="Script" pipelet-set-identifier="bc_api">
                <config-property key="ScriptFile" value="cart/ValidateCartForCheckout.ds"/>
                <config-property key="Transactional" value="false"/>
                <config-property key="Timeout" value="dw.system.Site.getCurrent().getCustomPreferenceValue('WebServiceTimeout')"/>
                <key-binding alias="null" key="ScriptLog"/>
                <key-binding alias="Basket" key="Basket"/>
                <key-binding alias="BasketStatus" key="BasketStatus"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
              <branch basename="b2" source-connector="error">
                <transition target-connector="in2" target-path="./+1">
                  <transition-display>
                    <bend-point relative-to="source" x="1" y="0"/>
                    <bend-point relative-to="target" x="1" y="0"/>
                  </transition-display>
                </transition>
              </branch>
            </node>
            <transition target-connector="in1" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition/>
            <node>
              <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                <key-binding alias="CouponStatus" key="From_0"/>
                <key-binding alias="CouponStatus" key="To_0"/>
                <key-binding alias="null" key="From_1"/>
                <key-binding alias="null" key="To_1"/>
                <key-binding alias="null" key="From_2"/>
                <key-binding alias="null" key="To_2"/>
                <key-binding alias="null" key="From_3"/>
                <key-binding alias="null" key="To_3"/>
                <key-binding alias="null" key="From_4"/>
                <key-binding alias="null" key="To_4"/>
                <key-binding alias="null" key="From_5"/>
                <key-binding alias="null" key="To_5"/>
                <key-binding alias="null" key="From_6"/>
                <key-binding alias="null" key="To_6"/>
                <key-binding alias="null" key="From_7"/>
                <key-binding alias="null" key="To_7"/>
                <key-binding alias="null" key="From_8"/>
                <key-binding alias="null" key="To_8"/>
                <key-binding alias="null" key="From_9"/>
                <key-binding alias="null" key="To_9"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition/>
            <node>
              <call-node start-name-ref="Cart-FetchWishList"/>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition/>
            <node>
              <end-node/>
              <node-display x="0" y="1"/>
            </node>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="1" y="0"/>
        </transition-display>
      </simple-transition>
      <node>
        <end-node/>
        <node-display orientation="horizontal" x="1" y="0"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_9">
    <segment>
      <node>
        <text-node>
          <description>By default, when a bundle is added to cart all its sub products gets added too, but if those products happens to be variants then we have to manually replace the master products with the selected variants which gets passed in the http params as childPids along with any options.
Params:
CurrentHttpParameterMap.childPids - comma separated list of pids of the bundled products which are variations</description>
        </text-node>
        <node-display width="3" x="18" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="ReplaceBundleLineItemProducts">
    <segment>
      <node>
        <start-node call-mode="private" name="ReplaceBundleLineItemProducts" secure="false"/>
        <node-display x="18" y="2"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
          <config-property key="Transactional" value="false"/>
          <key-binding alias="CurrentHttpParameterMap.childPids.stringValue.split(&quot;,&quot;)" key="From_0"/>
          <key-binding alias="childPids" key="To_0"/>
          <key-binding alias="null" key="From_1"/>
          <key-binding alias="null" key="To_1"/>
          <key-binding alias="null" key="From_2"/>
          <key-binding alias="null" key="To_2"/>
          <key-binding alias="null" key="From_3"/>
          <key-binding alias="null" key="To_3"/>
          <key-binding alias="null" key="From_4"/>
          <key-binding alias="null" key="To_4"/>
          <key-binding alias="null" key="From_5"/>
          <key-binding alias="null" key="To_5"/>
          <key-binding alias="null" key="From_6"/>
          <key-binding alias="null" key="To_6"/>
          <key-binding alias="null" key="From_7"/>
          <key-binding alias="null" key="To_7"/>
          <key-binding alias="null" key="From_8"/>
          <key-binding alias="null" key="To_8"/>
          <key-binding alias="null" key="From_9"/>
          <key-binding alias="null" key="To_9"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <loop-node element-key="childPid" iterator-key="childPids"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="do">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="0" y="1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <pipelet-node pipelet-name="GetProduct" pipelet-set-identifier="bc_api">
                <key-binding alias="ChildProduct" key="Product"/>
                <key-binding alias="childPid" key="ProductID"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
              <branch basename="b2" source-connector="error">
                <transition target-connector="in1" target-path="./b3.1">
                  <transition-display>
                    <bend-point relative-to="source" x="2" y="0"/>
                  </transition-display>
                </transition>
              </branch>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <pipelet-node pipelet-name="UpdateProductOptionSelections" pipelet-set-identifier="bc_api"/>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <pipelet-node pipelet-name="Script" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="false"/>
                <config-property key="OnError" value="PIPELET_ERROR"/>
                <config-property key="ScriptFile" value="cart/FindLineItem.ds"/>
                <key-binding alias="log" key="ScriptLog"/>
                <key-binding alias="(ChildProduct.isVariant() ? ChildProduct.masterProduct.ID: ChildProduct.ID)" key="pid"/>
                <key-binding alias="FoundLineItem" key="FoundLineItem"/>
                <key-binding alias="ProductLineItem.bundledProductLineItems" key="ProductLineItems"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
              <branch basename="b3" source-connector="error">
                <transition target-connector="in1"/>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="1" y="0"/>
                  </node>
                  <transition target-connector="in1" target-path="../b4.1"/>
                </segment>
              </branch>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <decision-node condition-key="empty(FoundLineItem)" condition-operator="expr"/>
              <node-display orientation="horizontal" x="0" y="1"/>
              <branch basename="b4" source-connector="yes">
                <transition target-connector="in2"/>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="1" y="0"/>
                  </node>
                  <transition target-connector="in1" target-path="../+1">
                    <transition-display>
                      <bend-point relative-to="target" x="2" y="0"/>
                    </transition-display>
                  </transition>
                </segment>
              </branch>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <pipelet-node pipelet-name="ReplaceLineItemProduct" pipelet-set-identifier="bc_api">
                <key-binding alias="FoundLineItem" key="ProductLineItem"/>
                <key-binding alias="ChildProduct" key="NewProduct"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
            </node>
            <transition target-connector="in1" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="0" y="1"/>
            </node>
            <transition target-connector="loop" target-path="..">
              <transition-display>
                <bend-point relative-to="source" x="-1" y="0"/>
                <bend-point relative-to="target" x="-1" y="0"/>
              </transition-display>
            </transition>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="1" y="0"/>
        </transition-display>
      </simple-transition>
      <node>
        <end-node/>
        <node-display orientation="horizontal" x="1" y="0"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_11">
    <segment>
      <node>
        <text-node>
          <description>Quick add the product to cart.</description>
        </text-node>
        <node-display x="22" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="QuickAdd">
    <segment>
      <node>
        <start-node call-mode="private" name="QuickAdd" secure="false"/>
        <node-display x="22" y="2"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <decision-node condition-key="!empty(CurrentForms.cart.quickProductID.value)" condition-operator="expr"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="yes">
          <transition target-connector="in"/>
          <segment>
            <node>
              <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="false"/>
                <key-binding alias="(empty(CurrentForms.cart.quickProductQuantity.value))?1:CurrentForms.cart.quickProductQuantity.value" key="From_0"/>
                <key-binding alias="quickAddQty" key="To_0"/>
                <key-binding alias="CurrentForms.cart.quickProductID.value" key="From_1"/>
                <key-binding alias="quickAddProductID" key="To_1"/>
                <key-binding alias="CurrentForms.cart.quickProductQuantity.value" key="From_2"/>
                <key-binding alias="ProductQuantity" key="To_2"/>
                <key-binding alias="CurrentForms.cart.quickProductID.value" key="From_3"/>
                <key-binding alias="ProductID" key="To_3"/>
                <key-binding alias="'QuickAdd'" key="From_4"/>
                <key-binding alias="ProductSource" key="To_4"/>
                <key-binding alias="null" key="From_5"/>
                <key-binding alias="null" key="To_5"/>
                <key-binding alias="null" key="From_6"/>
                <key-binding alias="null" key="To_6"/>
                <key-binding alias="null" key="From_7"/>
                <key-binding alias="null" key="To_7"/>
                <key-binding alias="null" key="From_8"/>
                <key-binding alias="null" key="To_8"/>
                <key-binding alias="null" key="From_9"/>
                <key-binding alias="null" key="To_9"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <call-node start-name-ref="Cart-CheckQuantity"/>
              <node-display x="0" y="1"/>
              <branch basename="b2" source-connector="error">
                <transition target-connector="in1" target-path="../+1"/>
              </branch>
              <branch basename="b3" source-connector="ok">
                <transition target-connector="in">
                  <transition-display>
                    <bend-point relative-to="source" x="0" y="1"/>
                  </transition-display>
                </transition>
                <segment>
                  <node>
                    <pipelet-node pipelet-name="GetProduct" pipelet-set-identifier="bc_api">
                      <key-binding alias="Product" key="Product"/>
                      <key-binding alias="CurrentForms.cart.quickProductID.value" key="ProductID"/>
                    </pipelet-node>
                    <node-display x="0" y="1"/>
                    <branch basename="b2" source-connector="error">
                      <transition target-connector="in"/>
                      <segment>
                        <node>
                          <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                            <config-property key="Transactional" value="false"/>
                            <key-binding alias="'Invalid Product.'" key="From_0"/>
                            <key-binding alias="quickAddStatus" key="To_0"/>
                            <key-binding alias="null" key="From_1"/>
                            <key-binding alias="null" key="To_1"/>
                            <key-binding alias="null" key="From_2"/>
                            <key-binding alias="null" key="To_2"/>
                            <key-binding alias="null" key="From_3"/>
                            <key-binding alias="null" key="To_3"/>
                            <key-binding alias="null" key="From_4"/>
                            <key-binding alias="null" key="To_4"/>
                            <key-binding alias="null" key="From_5"/>
                            <key-binding alias="null" key="To_5"/>
                            <key-binding alias="null" key="From_6"/>
                            <key-binding alias="null" key="To_6"/>
                            <key-binding alias="null" key="From_7"/>
                            <key-binding alias="null" key="To_7"/>
                            <key-binding alias="null" key="From_8"/>
                            <key-binding alias="null" key="To_8"/>
                            <key-binding alias="null" key="From_9"/>
                            <key-binding alias="null" key="To_9"/>
                          </pipelet-node>
                          <node-display orientation="horizontal" x="1" y="0"/>
                        </node>
                        <transition target-connector="in2" target-path="../../../+2"/>
                      </segment>
                    </branch>
                  </node>
                  <simple-transition>
                    <transition-display>
                      <bend-point relative-to="source" x="0" y="1"/>
                    </transition-display>
                  </simple-transition>
                  <node>
                    <pipelet-node pipelet-name="Script" pipelet-set-identifier="bc_api">
                      <config-property key="Transactional" value="false"/>
                      <config-property key="OnError" value="PIPELET_ERROR"/>
                      <config-property key="ScriptFile" value="product/CanCustomerPurchase.ds"/>
                      <key-binding alias="null" key="ScriptLog"/>
                      <key-binding alias="allowPurchase" key="allowPurchase"/>
                      <key-binding alias="CurrentCustomer" key="CurrentCustomer"/>
                      <key-binding alias="Product" key="Product"/>
                      <key-binding alias="CurrentCutomer" key="AwanaCustomer"/>
                      <key-binding alias="Product" key="AwanaProduct"/>
                      <key-binding alias="'Pipeline'" key="calledFrom"/>
                      <key-binding alias="quickAddStatus" key="reasonAllowPurchaseRejected"/>
                    </pipelet-node>
                    <node-display x="0" y="1"/>
                    <branch basename="b3" source-connector="error">
                      <transition target-connector="in1" target-path="../../+3">
                        <transition-display>
                          <bend-point relative-to="source" x="2" y="0"/>
                        </transition-display>
                      </transition>
                    </branch>
                  </node>
                  <simple-transition/>
                  <node>
                    <decision-node condition-key="allowPurchase" condition-operator="expr"/>
                    <node-display x="0" y="1"/>
                    <branch basename="b4" source-connector="yes">
                      <transition target-connector="in"/>
                      <segment>
                        <node>
                          <decision-node condition-key="Product.online &amp;&amp; (Product.availabilityModel != null) &amp;&amp; (Product.availabilityModel.orderable)" condition-operator="expr"/>
                          <node-display x="0" y="1"/>
                          <branch basename="b2" source-connector="yes">
                            <transition target-connector="in">
                              <transition-display>
                                <bend-point relative-to="source" x="0" y="1"/>
                              </transition-display>
                            </transition>
                            <segment>
                              <node>
                                <call-node start-name-ref="Cart-QuickAddChurchRewardsPoints"/>
                                <node-display x="0" y="1"/>
                                <branch basename="b2" source-connector="error">
                                  <transition target-connector="in">
                                    <transition-display>
                                      <bend-point relative-to="source" x="1" y="0"/>
                                    </transition-display>
                                  </transition>
                                  <segment>
                                    <node>
                                      <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                                        <config-property key="Transactional" value="false"/>
                                        <key-binding alias="quickChurchRewardsError" key="From_0"/>
                                        <key-binding alias="quickAddStatus" key="To_0"/>
                                        <key-binding alias="null" key="From_1"/>
                                        <key-binding alias="null" key="To_1"/>
                                        <key-binding alias="null" key="From_2"/>
                                        <key-binding alias="null" key="To_2"/>
                                        <key-binding alias="null" key="From_3"/>
                                        <key-binding alias="null" key="To_3"/>
                                        <key-binding alias="null" key="From_4"/>
                                        <key-binding alias="null" key="To_4"/>
                                        <key-binding alias="null" key="From_5"/>
                                        <key-binding alias="null" key="To_5"/>
                                        <key-binding alias="null" key="From_6"/>
                                        <key-binding alias="null" key="To_6"/>
                                        <key-binding alias="null" key="From_7"/>
                                        <key-binding alias="null" key="To_7"/>
                                        <key-binding alias="null" key="From_8"/>
                                        <key-binding alias="null" key="To_8"/>
                                        <key-binding alias="null" key="From_9"/>
                                        <key-binding alias="null" key="To_9"/>
                                      </pipelet-node>
                                      <node-display orientation="horizontal" x="1" y="0"/>
                                    </node>
                                    <transition target-connector="in1" target-path="../../../../../+6"/>
                                  </segment>
                                </branch>
                              </node>
                              <simple-transition>
                                <transition-display>
                                  <bend-point relative-to="source" x="0" y="1"/>
                                </transition-display>
                              </simple-transition>
                              <node>
                                <call-node start-name-ref="Cart-GetBasket"/>
                                <node-display x="0" y="1"/>
                                <branch basename="b3" source-connector="error">
                                  <transition target-connector="in"/>
                                  <segment>
                                    <node>
                                      <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                                        <config-property key="Transactional" value="false"/>
                                        <key-binding alias="'Error adding product.'" key="From_0"/>
                                        <key-binding alias="quickAddStatus" key="To_0"/>
                                        <key-binding alias="null" key="From_1"/>
                                        <key-binding alias="null" key="To_1"/>
                                        <key-binding alias="null" key="From_2"/>
                                        <key-binding alias="null" key="To_2"/>
                                        <key-binding alias="null" key="From_3"/>
                                        <key-binding alias="null" key="To_3"/>
                                        <key-binding alias="null" key="From_4"/>
                                        <key-binding alias="null" key="To_4"/>
                                        <key-binding alias="null" key="From_5"/>
                                        <key-binding alias="null" key="To_5"/>
                                        <key-binding alias="null" key="From_6"/>
                                        <key-binding alias="null" key="To_6"/>
                                        <key-binding alias="null" key="From_7"/>
                                        <key-binding alias="null" key="To_7"/>
                                        <key-binding alias="null" key="From_8"/>
                                        <key-binding alias="null" key="To_8"/>
                                        <key-binding alias="null" key="From_9"/>
                                        <key-binding alias="null" key="To_9"/>
                                      </pipelet-node>
                                      <node-display orientation="horizontal" x="1" y="0"/>
                                    </node>
                                    <transition target-connector="in1" target-path="../../../../../+7"/>
                                  </segment>
                                </branch>
                              </node>
                              <simple-transition/>
                              <node>
                                <decision-node condition-key="!Product.productSet &amp;&amp; !Product.bundle" condition-operator="expr"/>
                                <node-display x="0" y="1"/>
                                <branch basename="b4" source-connector="yes">
                                  <transition target-connector="in"/>
                                  <segment>
                                    <node>
                                      <decision-node condition-key="!Product.master" condition-operator="expr"/>
                                      <node-display x="0" y="1"/>
                                      <branch basename="b2" source-connector="yes">
                                        <transition target-connector="in"/>
                                        <segment>
                                          <node>
                                            <pipelet-node pipelet-name="UpdateProductOptionSelections" pipelet-set-identifier="bc_api"/>
                                            <node-display x="0" y="1"/>
                                          </node>
                                          <simple-transition/>
                                          <node>
                                            <pipelet-node pipelet-name="AddProductToBasket" pipelet-set-identifier="bc_api">
                                              <key-binding alias="Basket" key="Basket"/>
                                              <key-binding alias="Product" key="Product"/>
                                              <key-binding alias="ProductOptionModel" key="ProductOptionModel"/>
                                              <key-binding alias="new Number(quickAddQty)" key="Quantity"/>
                                              <key-binding alias="null" key="Shipment"/>
                                              <key-binding alias="ProductLineItem" key="ProductLineItem"/>
                                              <key-binding alias="dw.catalog.CatalogMgr.getCategory(CurrentHttpParameterMap.cgid.value)" key="Category"/>
                                            </pipelet-node>
                                            <node-display x="0" y="1"/>
                                            <branch basename="b2" source-connector="error">
                                              <transition target-connector="in"/>
                                              <segment>
                                                <node>
                                                  <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                                                    <config-property key="Transactional" value="false"/>
                                                    <key-binding alias="'Error adding product to cart.'" key="From_0"/>
                                                    <key-binding alias="quickAddStatus" key="To_0"/>
                                                    <key-binding alias="null" key="From_1"/>
                                                    <key-binding alias="null" key="To_1"/>
                                                    <key-binding alias="null" key="From_2"/>
                                                    <key-binding alias="null" key="To_2"/>
                                                    <key-binding alias="null" key="From_3"/>
                                                    <key-binding alias="null" key="To_3"/>
                                                    <key-binding alias="null" key="From_4"/>
                                                    <key-binding alias="null" key="To_4"/>
                                                    <key-binding alias="null" key="From_5"/>
                                                    <key-binding alias="null" key="To_5"/>
                                                    <key-binding alias="null" key="From_6"/>
                                                    <key-binding alias="null" key="To_6"/>
                                                    <key-binding alias="null" key="From_7"/>
                                                    <key-binding alias="null" key="To_7"/>
                                                    <key-binding alias="null" key="From_8"/>
                                                    <key-binding alias="null" key="To_8"/>
                                                    <key-binding alias="null" key="From_9"/>
                                                    <key-binding alias="null" key="To_9"/>
                                                  </pipelet-node>
                                                  <node-display orientation="horizontal" x="1" y="0"/>
                                                </node>
                                                <transition target-connector="in2" target-path="../../../../../../../+10"/>
                                              </segment>
                                            </branch>
                                          </node>
                                          <simple-transition>
                                            <transition-display>
                                              <bend-point relative-to="source" x="0" y="1"/>
                                            </transition-display>
                                          </simple-transition>
                                          <node>
                                            <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                                              <config-property key="Transactional" value="true"/>
                                              <key-binding alias="ProductLineItem.productID" key="From_0"/>
                                              <key-binding alias="productQuickAdded" key="To_0"/>
                                              <key-binding alias="null" key="From_1"/>
                                              <key-binding alias="null" key="To_1"/>
                                              <key-binding alias="null" key="From_2"/>
                                              <key-binding alias="null" key="To_2"/>
                                              <key-binding alias="null" key="From_3"/>
                                              <key-binding alias="null" key="To_3"/>
                                              <key-binding alias="null" key="From_4"/>
                                              <key-binding alias="null" key="To_4"/>
                                              <key-binding alias="null" key="From_5"/>
                                              <key-binding alias="null" key="To_5"/>
                                              <key-binding alias="null" key="From_6"/>
                                              <key-binding alias="null" key="To_6"/>
                                              <key-binding alias="null" key="From_7"/>
                                              <key-binding alias="null" key="To_7"/>
                                              <key-binding alias="null" key="From_8"/>
                                              <key-binding alias="null" key="To_8"/>
                                              <key-binding alias="null" key="From_9"/>
                                              <key-binding alias="null" key="To_9"/>
                                            </pipelet-node>
                                            <node-display x="0" y="1"/>
                                          </node>
                                          <simple-transition/>
                                          <node>
                                            <call-node start-name-ref="Cart-Calculate"/>
                                            <node-display x="0" y="1"/>
                                          </node>
                                          <simple-transition>
                                            <transition-display>
                                              <bend-point relative-to="source" x="0" y="1"/>
                                            </transition-display>
                                          </simple-transition>
                                          <node>
                                            <decision-node condition-key="!empty(Product.custom.ProductType) &amp;&amp; Product.custom.ProductType=='RewardsRedeemable' &amp;&amp; dw.system.Site.getCurrent().getCustomPreferenceValue('ChurchRewardsProgramActive')" condition-operator="expr"/>
                                            <node-display x="0" y="1"/>
                                            <branch basename="b3" source-connector="yes">
                                              <transition target-connector="in">
                                                <transition-display>
                                                  <bend-point relative-to="source" x="0" y="1"/>
                                                </transition-display>
                                              </transition>
                                              <segment>
                                                <node>
                                                  <call-node start-name-ref="Cart-GetRedeemableChurchRewardsPointsInCart"/>
                                                  <node-display x="0" y="1"/>
                                                </node>
                                                <simple-transition>
                                                  <transition-display>
                                                    <bend-point relative-to="source" x="0" y="1"/>
                                                  </transition-display>
                                                </simple-transition>
                                                <node>
                                                  <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                                                    <config-property key="Transactional" value="true"/>
                                                    <key-binding alias="totalRedeemablePointsInCart" key="From_0"/>
                                                    <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsPointsInCart" key="To_0"/>
                                                    <key-binding alias="null" key="From_1"/>
                                                    <key-binding alias="null" key="To_1"/>
                                                    <key-binding alias="null" key="From_2"/>
                                                    <key-binding alias="null" key="To_2"/>
                                                    <key-binding alias="null" key="From_3"/>
                                                    <key-binding alias="null" key="To_3"/>
                                                    <key-binding alias="null" key="From_4"/>
                                                    <key-binding alias="null" key="To_4"/>
                                                    <key-binding alias="null" key="From_5"/>
                                                    <key-binding alias="null" key="To_5"/>
                                                    <key-binding alias="null" key="From_6"/>
                                                    <key-binding alias="null" key="To_6"/>
                                                    <key-binding alias="null" key="From_7"/>
                                                    <key-binding alias="null" key="To_7"/>
                                                    <key-binding alias="null" key="From_8"/>
                                                    <key-binding alias="null" key="To_8"/>
                                                    <key-binding alias="null" key="From_9"/>
                                                    <key-binding alias="null" key="To_9"/>
                                                  </pipelet-node>
                                                  <node-display x="0" y="1"/>
                                                </node>
                                                <transition target-connector="in1" target-path="../../../../../../../+11">
                                                  <transition-display>
                                                    <bend-point relative-to="source" x="0" y="1"/>
                                                  </transition-display>
                                                </transition>
                                              </segment>
                                            </branch>
                                          </node>
                                          <transition target-connector="in1" target-path="../../../../../../+11">
                                            <transition-display>
                                              <bend-point relative-to="source" x="2" y="0"/>
                                            </transition-display>
                                          </transition>
                                        </segment>
                                      </branch>
                                    </node>
                                    <simple-transition>
                                      <transition-display>
                                        <bend-point relative-to="source" x="1" y="0"/>
                                      </transition-display>
                                    </simple-transition>
                                    <node>
                                      <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                                        <config-property key="Transactional" value="false"/>
                                        <key-binding alias="'Master products cannot be added via Quick Add.'" key="From_0"/>
                                        <key-binding alias="quickAddStatus" key="To_0"/>
                                        <key-binding alias="null" key="From_1"/>
                                        <key-binding alias="null" key="To_1"/>
                                        <key-binding alias="null" key="From_2"/>
                                        <key-binding alias="null" key="To_2"/>
                                        <key-binding alias="null" key="From_3"/>
                                        <key-binding alias="null" key="To_3"/>
                                        <key-binding alias="null" key="From_4"/>
                                        <key-binding alias="null" key="To_4"/>
                                        <key-binding alias="null" key="From_5"/>
                                        <key-binding alias="null" key="To_5"/>
                                        <key-binding alias="null" key="From_6"/>
                                        <key-binding alias="null" key="To_6"/>
                                        <key-binding alias="null" key="From_7"/>
                                        <key-binding alias="null" key="To_7"/>
                                        <key-binding alias="null" key="From_8"/>
                                        <key-binding alias="null" key="To_8"/>
                                        <key-binding alias="null" key="From_9"/>
                                        <key-binding alias="null" key="To_9"/>
                                      </pipelet-node>
                                      <node-display orientation="horizontal" x="1" y="0"/>
                                    </node>
                                    <transition target-connector="in2" target-path="../../../../../+9"/>
                                  </segment>
                                </branch>
                              </node>
                              <simple-transition>
                                <transition-display>
                                  <bend-point relative-to="source" x="1" y="0"/>
                                </transition-display>
                              </simple-transition>
                              <node>
                                <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                                  <config-property key="Transactional" value="false"/>
                                  <key-binding alias="'Product sets and product bundles cannot be added via Quick Add.'" key="From_0"/>
                                  <key-binding alias="quickAddStatus" key="To_0"/>
                                  <key-binding alias="null" key="From_1"/>
                                  <key-binding alias="null" key="To_1"/>
                                  <key-binding alias="null" key="From_2"/>
                                  <key-binding alias="null" key="To_2"/>
                                  <key-binding alias="null" key="From_3"/>
                                  <key-binding alias="null" key="To_3"/>
                                  <key-binding alias="null" key="From_4"/>
                                  <key-binding alias="null" key="To_4"/>
                                  <key-binding alias="null" key="From_5"/>
                                  <key-binding alias="null" key="To_5"/>
                                  <key-binding alias="null" key="From_6"/>
                                  <key-binding alias="null" key="To_6"/>
                                  <key-binding alias="null" key="From_7"/>
                                  <key-binding alias="null" key="To_7"/>
                                  <key-binding alias="null" key="From_8"/>
                                  <key-binding alias="null" key="To_8"/>
                                  <key-binding alias="null" key="From_9"/>
                                  <key-binding alias="null" key="To_9"/>
                                </pipelet-node>
                                <node-display orientation="horizontal" x="1" y="0"/>
                              </node>
                              <transition target-connector="in2" target-path="../../../../+8"/>
                            </segment>
                          </branch>
                        </node>
                        <simple-transition>
                          <transition-display>
                            <bend-point relative-to="source" x="1" y="0"/>
                          </transition-display>
                        </simple-transition>
                        <node>
                          <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                            <config-property key="Transactional" value="false"/>
                            <key-binding alias="'The selected product is not available for purchase.'" key="From_0"/>
                            <key-binding alias="quickAddStatus" key="To_0"/>
                            <key-binding alias="null" key="From_1"/>
                            <key-binding alias="null" key="To_1"/>
                            <key-binding alias="null" key="From_2"/>
                            <key-binding alias="null" key="To_2"/>
                            <key-binding alias="null" key="From_3"/>
                            <key-binding alias="null" key="To_3"/>
                            <key-binding alias="null" key="From_4"/>
                            <key-binding alias="null" key="To_4"/>
                            <key-binding alias="null" key="From_5"/>
                            <key-binding alias="null" key="To_5"/>
                            <key-binding alias="null" key="From_6"/>
                            <key-binding alias="null" key="To_6"/>
                            <key-binding alias="null" key="From_7"/>
                            <key-binding alias="null" key="To_7"/>
                            <key-binding alias="null" key="From_8"/>
                            <key-binding alias="null" key="To_8"/>
                            <key-binding alias="null" key="From_9"/>
                            <key-binding alias="null" key="To_9"/>
                          </pipelet-node>
                          <node-display orientation="horizontal" x="1" y="0"/>
                        </node>
                        <transition target-connector="in1" target-path="../../../+5"/>
                      </segment>
                    </branch>
                  </node>
                  <transition target-connector="in1" target-path="../../+4">
                    <transition-display>
                      <bend-point relative-to="source" x="2" y="0"/>
                    </transition-display>
                  </transition>
                </segment>
              </branch>
            </node>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="1" y="0"/>
        </transition-display>
      </simple-transition>
      <node>
        <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
          <config-property key="Transactional" value="false"/>
          <key-binding alias="'Please enter a product id.'" key="From_0"/>
          <key-binding alias="quickAddStatus" key="To_0"/>
          <key-binding alias="null" key="From_1"/>
          <key-binding alias="null" key="To_1"/>
          <key-binding alias="null" key="From_2"/>
          <key-binding alias="null" key="To_2"/>
          <key-binding alias="null" key="From_3"/>
          <key-binding alias="null" key="To_3"/>
          <key-binding alias="null" key="From_4"/>
          <key-binding alias="null" key="To_4"/>
          <key-binding alias="null" key="From_5"/>
          <key-binding alias="null" key="To_5"/>
          <key-binding alias="null" key="From_6"/>
          <key-binding alias="null" key="To_6"/>
          <key-binding alias="null" key="From_7"/>
          <key-binding alias="null" key="To_7"/>
          <key-binding alias="null" key="From_8"/>
          <key-binding alias="null" key="To_8"/>
          <key-binding alias="null" key="From_9"/>
          <key-binding alias="null" key="To_9"/>
        </pipelet-node>
        <node-display orientation="horizontal" x="1" y="0"/>
      </node>
      <transition target-connector="in1" target-path="./+1">
        <transition-display>
          <bend-point relative-to="source" x="2" y="0"/>
        </transition-display>
      </transition>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="1" y="2"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="2"/>
      </node>
      <transition target-connector="in3" target-path="./+1">
        <transition-display>
          <bend-point relative-to="target" x="2" y="0"/>
        </transition-display>
      </transition>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="-1" y="5"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <end-node/>
        <node-display x="0" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_13">
    <segment>
      <node>
        <text-node>
          <description>Get the total amount of redeemable church rewards points in the cart</description>
        </text-node>
        <node-display x="27" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="GetRedeemableChurchRewardsPointsInCart">
    <segment>
      <node>
        <start-node call-mode="private" name="GetRedeemableChurchRewardsPointsInCart" secure="false"/>
        <node-display x="27" y="2"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <decision-node condition-key="!empty(CurrentCustomer.profile) &amp;&amp; CurrentCustomer.profile.custom.CustomerType=='Commander'" condition-operator="expr"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="yes">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="0" y="1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <call-node start-name-ref="Cart-GetBasket"/>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="false"/>
                <key-binding alias="0" key="From_0"/>
                <key-binding alias="totalRedeemablePointsInCart" key="To_0"/>
                <key-binding alias="null" key="From_1"/>
                <key-binding alias="null" key="From_2"/>
                <key-binding alias="null" key="To_2"/>
                <key-binding alias="null" key="From_3"/>
                <key-binding alias="null" key="To_3"/>
                <key-binding alias="null" key="From_4"/>
                <key-binding alias="null" key="To_4"/>
                <key-binding alias="null" key="From_5"/>
                <key-binding alias="null" key="To_5"/>
                <key-binding alias="null" key="From_6"/>
                <key-binding alias="null" key="To_6"/>
                <key-binding alias="null" key="From_7"/>
                <key-binding alias="null" key="To_7"/>
                <key-binding alias="null" key="From_8"/>
                <key-binding alias="null" key="To_8"/>
                <key-binding alias="null" key="From_9"/>
                <key-binding alias="null" key="To_9"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
            </node>
            <transition target-connector="in" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <loop-node element-key="bli" iterator-key="Basket.allProductLineItems"/>
              <node-display x="0" y="1"/>
              <branch basename="b2" source-connector="do">
                <transition target-connector="in"/>
                <segment>
                  <node>
                    <decision-node condition-key="!empty(bli.product.custom.ProductType) &amp;&amp; bli.product.custom.ProductType==&quot;RewardsRedeemable&quot;" condition-operator="expr"/>
                    <node-display x="0" y="1"/>
                    <branch basename="b2" source-connector="yes">
                      <transition target-connector="in">
                        <transition-display>
                          <bend-point relative-to="source" x="0" y="1"/>
                        </transition-display>
                      </transition>
                      <segment>
                        <node>
                          <decision-node condition-key="!empty(bli.product.custom.ChurchRewardsPointsCategory) &amp;&amp; bli.product.custom.ChurchRewardsPointsCategory&gt;0" condition-operator="expr"/>
                          <node-display x="0" y="1"/>
                          <branch basename="b2" source-connector="yes">
                            <transition target-connector="in">
                              <transition-display>
                                <bend-point relative-to="source" x="0" y="1"/>
                              </transition-display>
                            </transition>
                            <segment>
                              <node>
                                <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                                  <config-property key="Transactional" value="false"/>
                                  <key-binding alias="totalRedeemablePointsInCart+(bli.product.custom.ChurchRewardsPointsCategory*bli.quantity.value)" key="From_0"/>
                                  <key-binding alias="totalRedeemablePointsInCart" key="To_0"/>
                                  <key-binding alias="null" key="From_1"/>
                                  <key-binding alias="null" key="To_1"/>
                                  <key-binding alias="null" key="From_2"/>
                                  <key-binding alias="null" key="To_2"/>
                                  <key-binding alias="null" key="From_3"/>
                                  <key-binding alias="null" key="To_3"/>
                                  <key-binding alias="null" key="From_4"/>
                                  <key-binding alias="null" key="To_4"/>
                                  <key-binding alias="null" key="From_5"/>
                                  <key-binding alias="null" key="To_5"/>
                                  <key-binding alias="null" key="From_6"/>
                                  <key-binding alias="null" key="To_6"/>
                                  <key-binding alias="null" key="From_7"/>
                                  <key-binding alias="null" key="To_7"/>
                                  <key-binding alias="null" key="From_8"/>
                                  <key-binding alias="null" key="To_8"/>
                                  <key-binding alias="null" key="From_9"/>
                                  <key-binding alias="null" key="To_9"/>
                                </pipelet-node>
                                <node-display x="0" y="1"/>
                              </node>
                              <transition target-connector="in1" target-path="../../+4"/>
                            </segment>
                          </branch>
                        </node>
                        <transition target-connector="in1" target-path="../+2"/>
                      </segment>
                    </branch>
                  </node>
                  <transition target-connector="in1" target-path="./+1"/>
                </segment>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="1" y="0"/>
                  </node>
                  <transition target-connector="in1" target-path="./+1"/>
                </segment>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="0" y="1"/>
                  </node>
                  <transition target-connector="in1" target-path="./+1"/>
                </segment>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="0" y="2"/>
                  </node>
                  <transition target-connector="in1" target-path="./+1"/>
                </segment>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="-1" y="0"/>
                  </node>
                  <transition target-connector="in1" target-path="./+1"/>
                </segment>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="-1" y="0"/>
                  </node>
                  <transition target-connector="in1" target-path="./+1"/>
                </segment>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="0" y="-4"/>
                  </node>
                  <transition target-connector="loop" target-path="..">
                    <transition-display>
                      <bend-point relative-to="source" x="1" y="0"/>
                    </transition-display>
                  </transition>
                </segment>
              </branch>
            </node>
            <transition target-connector="in1" target-path="../+2"/>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="1" y="0"/>
        </transition-display>
      </simple-transition>
      <node>
        <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
          <config-property key="Transactional" value="false"/>
          <key-binding alias="0" key="From_0"/>
          <key-binding alias="totalRedeemablePointsInCart" key="To_0"/>
          <key-binding alias="null" key="From_1"/>
          <key-binding alias="null" key="To_1"/>
          <key-binding alias="null" key="From_2"/>
          <key-binding alias="null" key="To_2"/>
          <key-binding alias="null" key="From_3"/>
          <key-binding alias="null" key="To_3"/>
          <key-binding alias="null" key="From_4"/>
          <key-binding alias="null" key="To_4"/>
          <key-binding alias="null" key="From_5"/>
          <key-binding alias="null" key="To_5"/>
          <key-binding alias="null" key="From_6"/>
          <key-binding alias="null" key="To_6"/>
          <key-binding alias="null" key="From_7"/>
          <key-binding alias="null" key="To_7"/>
          <key-binding alias="null" key="From_8"/>
          <key-binding alias="null" key="To_8"/>
          <key-binding alias="null" key="From_9"/>
          <key-binding alias="null" key="To_9"/>
        </pipelet-node>
        <node-display orientation="horizontal" x="1" y="0"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="1" y="0"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="3"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="1" y="0"/>
        </transition-display>
      </simple-transition>
      <node>
        <end-node name="ok"/>
        <node-display orientation="horizontal" x="1" y="0"/>
      </node>
    </segment>
  </branch>
  <branch basename="QuickRemoveChurchRewardsPoints">
    <segment>
      <node>
        <start-node call-mode="private" name="QuickRemoveChurchRewardsPoints" secure="false"/>
        <node-display x="32" y="2"/>
      </node>
      <simple-transition/>
      <node>
        <call-node start-name-ref="Cart-GetRedeemableChurchRewardsPointsInCart"/>
        <node-display x="0" y="1"/>
      </node>
      <simple-transition/>
      <node>
        <decision-node condition-key="!empty(CurrentCustomer.profile) &amp;&amp; CurrentCustomer.profile.custom.CustomerType=='Commander' &amp;&amp; dw.system.Site.getCurrent().getCustomPreferenceValue('ChurchRewardsProgramActive')" condition-operator="expr"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="yes">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="0" y="1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="true"/>
                <key-binding alias="totalRedeemablePointsInCart" key="From_0"/>
                <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsPointsInCart" key="To_0"/>
                <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsPointsAtLogin-totalRedeemablePointsInCart" key="From_1"/>
                <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsChurchPointsAvailable" key="To_1"/>
                <key-binding alias="null" key="From_2"/>
                <key-binding alias="null" key="To_2"/>
                <key-binding alias="null" key="From_3"/>
                <key-binding alias="null" key="To_3"/>
                <key-binding alias="null" key="From_4"/>
                <key-binding alias="null" key="To_4"/>
                <key-binding alias="null" key="From_5"/>
                <key-binding alias="null" key="To_5"/>
                <key-binding alias="null" key="From_6"/>
                <key-binding alias="null" key="To_6"/>
                <key-binding alias="null" key="From_7"/>
                <key-binding alias="null" key="To_7"/>
                <key-binding alias="null" key="From_8"/>
                <key-binding alias="null" key="To_8"/>
                <key-binding alias="null" key="From_9"/>
                <key-binding alias="null" key="To_9"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
            </node>
            <transition target-connector="in1" target-path="../+3"/>
          </segment>
        </branch>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="1" y="0"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="2"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="-1" y="0"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <end-node name="ok"/>
        <node-display x="0" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="GetQualifyingChurchRewardsPointsInCart">
    <segment>
      <node>
        <start-node call-mode="private" name="GetQualifyingChurchRewardsPointsInCart" secure="false"/>
        <node-display x="36" y="2"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <decision-node condition-key="!empty(CurrentCustomer.profile) &amp;&amp; CurrentCustomer.profile.custom.IsChurchRewardsSponsor &amp;&amp; dw.system.Site.getCurrent().getCustomPreferenceValue('ChurchRewardsProgramActive')" condition-operator="expr"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="yes">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="0" y="1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <call-node start-name-ref="Cart-GetBasket"/>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="false"/>
                <key-binding alias="0" key="From_0"/>
                <key-binding alias="totalQualifyingPointsInCart" key="To_0"/>
                <key-binding alias="null" key="From_1"/>
                <key-binding alias="null" key="From_2"/>
                <key-binding alias="null" key="To_2"/>
                <key-binding alias="null" key="From_3"/>
                <key-binding alias="null" key="To_3"/>
                <key-binding alias="null" key="From_4"/>
                <key-binding alias="null" key="To_4"/>
                <key-binding alias="null" key="From_5"/>
                <key-binding alias="null" key="To_5"/>
                <key-binding alias="null" key="From_6"/>
                <key-binding alias="null" key="To_6"/>
                <key-binding alias="null" key="From_7"/>
                <key-binding alias="null" key="To_7"/>
                <key-binding alias="null" key="From_8"/>
                <key-binding alias="null" key="To_8"/>
                <key-binding alias="null" key="From_9"/>
                <key-binding alias="null" key="To_9"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
            </node>
            <transition target-connector="in" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <loop-node element-key="bli" iterator-key="Basket.allProductLineItems"/>
              <node-display x="0" y="1"/>
              <branch basename="b2" source-connector="do">
                <transition target-connector="in"/>
                <segment>
                  <node>
                    <decision-node condition-key="!empty(bli.product.custom.ProductType) &amp;&amp; bli.product.custom.ProductType==&quot;RewardsQualifying&quot;" condition-operator="expr"/>
                    <node-display x="0" y="1"/>
                    <branch basename="b2" source-connector="yes">
                      <transition target-connector="in">
                        <transition-display>
                          <bend-point relative-to="source" x="0" y="1"/>
                        </transition-display>
                      </transition>
                      <segment>
                        <node>
                          <decision-node condition-key="!empty(bli.adjustedNetPrice.value) &amp;&amp; bli.adjustedNetPrice.value&gt;0" condition-operator="expr"/>
                          <node-display x="0" y="1"/>
                          <branch basename="b2" source-connector="yes">
                            <transition target-connector="in">
                              <transition-display>
                                <bend-point relative-to="source" x="0" y="1"/>
                              </transition-display>
                            </transition>
                            <segment>
                              <node>
                                <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                                  <config-property key="Transactional" value="false"/>
                                  <key-binding alias="totalQualifyingPointsInCart+Math.ceil(bli.adjustedNetPrice.value)" key="From_0"/>
                                  <key-binding alias="totalQualifyingPointsInCart" key="To_0"/>
                                  <key-binding alias="null" key="From_1"/>
                                  <key-binding alias="null" key="To_1"/>
                                  <key-binding alias="null" key="From_2"/>
                                  <key-binding alias="null" key="To_2"/>
                                  <key-binding alias="null" key="From_3"/>
                                  <key-binding alias="null" key="To_3"/>
                                  <key-binding alias="null" key="From_4"/>
                                  <key-binding alias="null" key="To_4"/>
                                  <key-binding alias="null" key="From_5"/>
                                  <key-binding alias="null" key="To_5"/>
                                  <key-binding alias="null" key="From_6"/>
                                  <key-binding alias="null" key="To_6"/>
                                  <key-binding alias="null" key="From_7"/>
                                  <key-binding alias="null" key="To_7"/>
                                  <key-binding alias="null" key="From_8"/>
                                  <key-binding alias="null" key="To_8"/>
                                  <key-binding alias="null" key="From_9"/>
                                  <key-binding alias="null" key="To_9"/>
                                </pipelet-node>
                                <node-display x="0" y="1"/>
                              </node>
                              <transition target-connector="in1" target-path="../../+5"/>
                            </segment>
                          </branch>
                        </node>
                        <simple-transition>
                          <transition-display>
                            <bend-point relative-to="source" x="1" y="0"/>
                            <bend-point relative-to="source" x="1" y="-1"/>
                            <bend-point relative-to="target" x="0" y="-1"/>
                          </transition-display>
                        </simple-transition>
                        <node>
                          <decision-node condition-key="!empty(bli.netPrice.value) &amp;&amp; bli.netPrice.value&gt;0" condition-operator="expr"/>
                          <node-display x="1" y="0"/>
                          <branch basename="b3" source-connector="yes">
                            <transition target-connector="in">
                              <transition-display>
                                <bend-point relative-to="source" x="0" y="1"/>
                              </transition-display>
                            </transition>
                            <segment>
                              <node>
                                <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                                  <config-property key="Transactional" value="false"/>
                                  <key-binding alias="totalQualifyingPointsInCart+Math.ceil(bli.netPrice.value)" key="From_0"/>
                                  <key-binding alias="totalQualifyingPointsInCart" key="To_0"/>
                                  <key-binding alias="null" key="From_1"/>
                                  <key-binding alias="null" key="To_1"/>
                                  <key-binding alias="null" key="From_2"/>
                                  <key-binding alias="null" key="To_2"/>
                                  <key-binding alias="null" key="From_3"/>
                                  <key-binding alias="null" key="To_3"/>
                                  <key-binding alias="null" key="From_4"/>
                                  <key-binding alias="null" key="To_4"/>
                                  <key-binding alias="null" key="From_5"/>
                                  <key-binding alias="null" key="To_5"/>
                                  <key-binding alias="null" key="From_6"/>
                                  <key-binding alias="null" key="To_6"/>
                                  <key-binding alias="null" key="From_7"/>
                                  <key-binding alias="null" key="To_7"/>
                                  <key-binding alias="null" key="From_8"/>
                                  <key-binding alias="null" key="To_8"/>
                                  <key-binding alias="null" key="From_9"/>
                                  <key-binding alias="null" key="To_9"/>
                                </pipelet-node>
                                <node-display x="0" y="1"/>
                              </node>
                              <transition target-connector="in1" target-path="../../+4"/>
                            </segment>
                          </branch>
                        </node>
                        <transition target-connector="in1" target-path="../+2"/>
                      </segment>
                    </branch>
                  </node>
                  <transition target-connector="in1" target-path="./+1"/>
                </segment>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="2" y="0"/>
                  </node>
                  <transition target-connector="in1" target-path="./+1"/>
                </segment>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="0" y="1"/>
                  </node>
                  <transition target-connector="in1" target-path="./+1"/>
                </segment>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="0" y="2"/>
                  </node>
                  <transition target-connector="in1" target-path="./+1"/>
                </segment>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="-1" y="0"/>
                  </node>
                  <transition target-connector="in1" target-path="./+1"/>
                </segment>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="-1" y="0"/>
                  </node>
                  <transition target-connector="in1" target-path="./+1"/>
                </segment>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="-1" y="0"/>
                  </node>
                  <transition target-connector="in1" target-path="./+1"/>
                </segment>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="0" y="-4"/>
                  </node>
                  <transition target-connector="loop" target-path="..">
                    <transition-display>
                      <bend-point relative-to="source" x="1" y="0"/>
                    </transition-display>
                  </transition>
                </segment>
              </branch>
            </node>
            <transition target-connector="in1" target-path="../+1"/>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="1" y="0"/>
        </transition-display>
      </simple-transition>
      <node>
        <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
          <config-property key="Transactional" value="false"/>
          <key-binding alias="0" key="From_0"/>
          <key-binding alias="totalQualifyingPointsInCart" key="To_0"/>
          <key-binding alias="null" key="From_1"/>
          <key-binding alias="null" key="To_1"/>
          <key-binding alias="null" key="From_2"/>
          <key-binding alias="null" key="To_2"/>
          <key-binding alias="null" key="From_3"/>
          <key-binding alias="null" key="To_3"/>
          <key-binding alias="null" key="From_4"/>
          <key-binding alias="null" key="To_4"/>
          <key-binding alias="null" key="From_5"/>
          <key-binding alias="null" key="To_5"/>
          <key-binding alias="null" key="From_6"/>
          <key-binding alias="null" key="To_6"/>
          <key-binding alias="null" key="From_7"/>
          <key-binding alias="null" key="To_7"/>
          <key-binding alias="null" key="From_8"/>
          <key-binding alias="null" key="To_8"/>
          <key-binding alias="null" key="From_9"/>
          <key-binding alias="null" key="To_9"/>
        </pipelet-node>
        <node-display orientation="horizontal" x="1" y="0"/>
      </node>
      <transition target-connector="in1" target-path="./+1">
        <transition-display>
          <bend-point relative-to="source" x="1" y="0"/>
        </transition-display>
      </transition>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="3"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="1" y="0"/>
        </transition-display>
      </simple-transition>
      <node>
        <end-node name="ok"/>
        <node-display orientation="horizontal" x="1" y="0"/>
      </node>
    </segment>
  </branch>
  <branch basename="SearchForLineItemInBasket">
    <segment>
      <node>
        <start-node call-mode="private" name="SearchForLineItemInBasket" secure="false"/>
        <node-display x="41" y="2"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
          <config-property key="Transactional" value="false"/>
          <key-binding alias="false" key="From_0"/>
          <key-binding alias="LineItemFound" key="To_0"/>
          <key-binding alias="null" key="From_1"/>
          <key-binding alias="null" key="To_1"/>
          <key-binding alias="null" key="From_2"/>
          <key-binding alias="null" key="To_2"/>
          <key-binding alias="null" key="From_3"/>
          <key-binding alias="null" key="To_3"/>
          <key-binding alias="null" key="From_4"/>
          <key-binding alias="null" key="To_4"/>
          <key-binding alias="null" key="From_5"/>
          <key-binding alias="null" key="To_5"/>
          <key-binding alias="null" key="From_6"/>
          <key-binding alias="null" key="To_6"/>
          <key-binding alias="null" key="From_7"/>
          <key-binding alias="null" key="To_7"/>
          <key-binding alias="null" key="From_8"/>
          <key-binding alias="null" key="To_8"/>
          <key-binding alias="null" key="From_9"/>
          <key-binding alias="null" key="To_9"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in" target-path="./+1">
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </transition>
    </segment>
    <segment>
      <node>
        <loop-node element-key="LineItemIterator" iterator-key="Basket.allProductLineItems"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="do">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="0" y="1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <decision-node condition-key="LineItemIterator.ID == ProductIDToSearchFor" condition-operator="expr"/>
              <node-display x="0" y="1"/>
              <branch basename="b2" source-connector="yes">
                <transition target-connector="in">
                  <transition-display>
                    <bend-point relative-to="source" x="0" y="1"/>
                  </transition-display>
                </transition>
                <segment>
                  <node>
                    <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                      <config-property key="Transactional" value="false"/>
                      <key-binding alias="true" key="From_0"/>
                      <key-binding alias="LineItemFound" key="To_0"/>
                      <key-binding alias="null" key="From_1"/>
                      <key-binding alias="null" key="To_1"/>
                      <key-binding alias="null" key="From_2"/>
                      <key-binding alias="null" key="To_2"/>
                      <key-binding alias="null" key="From_3"/>
                      <key-binding alias="null" key="To_3"/>
                      <key-binding alias="null" key="From_4"/>
                      <key-binding alias="null" key="To_4"/>
                      <key-binding alias="null" key="From_5"/>
                      <key-binding alias="null" key="To_5"/>
                      <key-binding alias="null" key="From_6"/>
                      <key-binding alias="null" key="To_6"/>
                      <key-binding alias="null" key="From_7"/>
                      <key-binding alias="null" key="To_7"/>
                      <key-binding alias="null" key="From_8"/>
                      <key-binding alias="null" key="To_8"/>
                      <key-binding alias="null" key="From_9"/>
                      <key-binding alias="null" key="To_9"/>
                    </pipelet-node>
                    <node-display x="0" y="1"/>
                  </node>
                  <transition target-connector="in1" target-path="../../+3"/>
                </segment>
              </branch>
            </node>
            <transition target-connector="in1" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="1" y="0"/>
            </node>
            <transition target-connector="in1" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="0" y="4"/>
            </node>
            <transition target-connector="in1" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="-2" y="0"/>
            </node>
            <transition target-connector="in1" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="0" y="-5"/>
            </node>
            <transition target-connector="loop" target-path="..">
              <transition-display>
                <bend-point relative-to="source" x="1" y="0"/>
              </transition-display>
            </transition>
          </segment>
        </branch>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="2" y="0"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="3"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="-2" y="0"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <end-node name="ok"/>
        <node-display x="0" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_18">
    <segment>
      <node>
        <text-node>
          <description>Renders a minified version of the basket.</description>
        </text-node>
        <node-display x="8" y="6"/>
      </node>
    </segment>
  </branch>
  <branch basename="MiniCart">
    <segment>
      <node>
        <start-node name="MiniCart" secure="false"/>
        <node-display x="8" y="7"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <call-node start-name-ref="Cart-GetExistingBasket"/>
        <node-display x="0" y="1"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <interaction-node transaction-required="false">
          <template buffered="true" dynamic="false" name="checkout/cart/minicart"/>
        </interaction-node>
        <node-display x="0" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="StartWithError">
    <segment>
      <node>
        <start-node call-mode="private" name="StartWithError" secure="false"/>
        <node-display orientation="horizontal" x="2" y="9"/>
      </node>
      <transition target-connector="in2" target-path="/Show.3"/>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_21">
    <segment>
      <node>
        <text-node>
          <description>The cart page provides various actions to be performed, e.g. line item editing, coupon redemption etc.</description>
        </text-node>
        <node-display x="1" y="10"/>
      </node>
    </segment>
  </branch>
  <branch basename="QuickAddChurchRewardsPoints">
    <segment>
      <node>
        <start-node call-mode="private" name="QuickAddChurchRewardsPoints" secure="false"/>
        <node-display x="33" y="11"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
          <config-property key="Transactional" value="false"/>
          <key-binding alias="null" key="From_0"/>
          <key-binding alias="quickChurchRewardsError" key="To_0"/>
          <key-binding alias="null" key="From_1"/>
          <key-binding alias="null" key="To_1"/>
          <key-binding alias="null" key="From_2"/>
          <key-binding alias="null" key="To_2"/>
          <key-binding alias="null" key="From_3"/>
          <key-binding alias="null" key="To_3"/>
          <key-binding alias="null" key="From_4"/>
          <key-binding alias="null" key="To_4"/>
          <key-binding alias="null" key="From_5"/>
          <key-binding alias="null" key="To_5"/>
          <key-binding alias="null" key="From_6"/>
          <key-binding alias="null" key="To_6"/>
          <key-binding alias="null" key="From_7"/>
          <key-binding alias="null" key="To_7"/>
          <key-binding alias="null" key="From_8"/>
          <key-binding alias="null" key="To_8"/>
          <key-binding alias="null" key="From_9"/>
          <key-binding alias="null" key="To_9"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
      </node>
      <simple-transition/>
      <node>
        <decision-node condition-key="!empty(Product.custom.ProductType) &amp;&amp; Product.custom.ProductType=='RewardsRedeemable'" condition-operator="expr"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="yes">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="0" y="1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <decision-node condition-key="!empty(CurrentCustomer.profile) &amp;&amp; CurrentCustomer.profile.custom.CustomerType=='Commander'" condition-operator="expr"/>
              <node-display x="0" y="1"/>
              <branch basename="b2" source-connector="yes">
                <transition target-connector="in">
                  <transition-display>
                    <bend-point relative-to="source" x="0" y="1"/>
                  </transition-display>
                </transition>
                <segment>
                  <node>
                    <decision-node condition-key="!empty(Product.custom.ChurchRewardsPointsCategory) &amp;&amp; Product.custom.ChurchRewardsPointsCategory&gt;0" condition-operator="expr"/>
                    <node-display x="0" y="1"/>
                    <branch basename="b2" source-connector="yes">
                      <transition target-connector="in">
                        <transition-display>
                          <bend-point relative-to="source" x="0" y="1"/>
                        </transition-display>
                      </transition>
                      <segment>
                        <node>
                          <decision-node condition-key="CurrentCustomer.profile.custom.ChurchRewardsChurchPointsAvailable&gt;=(Product.custom.ChurchRewardsPointsCategory*quickAddQty)" condition-operator="expr"/>
                          <node-display x="0" y="1"/>
                          <branch basename="b2" source-connector="yes">
                            <transition target-connector="in">
                              <transition-display>
                                <bend-point relative-to="source" x="0" y="1"/>
                              </transition-display>
                            </transition>
                            <segment>
                              <node>
                                <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                                  <config-property key="Transactional" value="true"/>
                                  <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsChurchPointsAvailable-(Product.custom.ChurchRewardsPointsCategory*quickAddQty)" key="From_0"/>
                                  <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsChurchPointsAvailable" key="To_0"/>
                                  <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsPointsInCart-(Product.custom.ChurchRewardsPointsCategory*quickAddQty)" key="From_1"/>
                                  <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsPointsInCart" key="To_1"/>
                                  <key-binding alias="null" key="From_2"/>
                                  <key-binding alias="null" key="To_2"/>
                                  <key-binding alias="null" key="From_3"/>
                                  <key-binding alias="null" key="To_3"/>
                                  <key-binding alias="null" key="From_4"/>
                                  <key-binding alias="null" key="To_4"/>
                                  <key-binding alias="null" key="From_5"/>
                                  <key-binding alias="null" key="To_5"/>
                                  <key-binding alias="null" key="From_6"/>
                                  <key-binding alias="null" key="To_6"/>
                                  <key-binding alias="null" key="From_7"/>
                                  <key-binding alias="null" key="To_7"/>
                                  <key-binding alias="null" key="From_8"/>
                                  <key-binding alias="null" key="To_8"/>
                                  <key-binding alias="null" key="From_9"/>
                                  <key-binding alias="null" key="To_9"/>
                                </pipelet-node>
                                <node-display x="0" y="1"/>
                              </node>
                              <transition target-connector="in1" target-path="../../../../+6"/>
                            </segment>
                          </branch>
                        </node>
                        <simple-transition>
                          <transition-display>
                            <bend-point relative-to="source" x="1" y="0"/>
                          </transition-display>
                        </simple-transition>
                        <node>
                          <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                            <config-property key="Transactional" value="false"/>
                            <key-binding alias="&quot;Your church does not have enough points to purchase that many of this product.&quot;" key="From_0"/>
                            <key-binding alias="quickChurchRewardsError" key="To_0"/>
                            <key-binding alias="null" key="From_1"/>
                            <key-binding alias="null" key="To_1"/>
                            <key-binding alias="null" key="From_2"/>
                            <key-binding alias="null" key="To_2"/>
                            <key-binding alias="null" key="From_3"/>
                            <key-binding alias="null" key="To_3"/>
                            <key-binding alias="null" key="From_4"/>
                            <key-binding alias="null" key="To_4"/>
                            <key-binding alias="null" key="From_5"/>
                            <key-binding alias="null" key="To_5"/>
                            <key-binding alias="null" key="From_6"/>
                            <key-binding alias="null" key="To_6"/>
                            <key-binding alias="null" key="From_7"/>
                            <key-binding alias="null" key="To_7"/>
                            <key-binding alias="null" key="From_8"/>
                            <key-binding alias="null" key="To_8"/>
                            <key-binding alias="null" key="From_9"/>
                            <key-binding alias="null" key="To_9"/>
                          </pipelet-node>
                          <node-display orientation="horizontal" x="1" y="0"/>
                        </node>
                        <transition target-connector="in1" target-path="../../../+4"/>
                      </segment>
                    </branch>
                  </node>
                  <simple-transition>
                    <transition-display>
                      <bend-point relative-to="source" x="1" y="0"/>
                    </transition-display>
                  </simple-transition>
                  <node>
                    <pipelet-node pipelet-name="SendMail" pipelet-set-identifier="bc_api">
                      <key-binding alias="&quot;store@awana.org&quot;" key="MailFrom"/>
                      <key-binding alias="&quot;mail/nopointcategory.isml&quot;" key="MailTemplate"/>
                      <key-binding alias="&quot;jasonp@awana.org&quot;" key="MailTo"/>
                      <key-binding alias="&quot;Redeemable Product Has Zero Price In Demandware&quot;" key="MailSubject"/>
                      <key-binding alias="null" key="LocaleID"/>
                      <key-binding alias="null" key="MailCC"/>
                      <key-binding alias="null" key="MailBCC"/>
                    </pipelet-node>
                    <node-display orientation="horizontal" x="1" y="0"/>
                  </node>
                  <simple-transition>
                    <transition-display>
                      <bend-point relative-to="source" x="1" y="0"/>
                    </transition-display>
                  </simple-transition>
                  <node>
                    <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                      <config-property key="Transactional" value="false"/>
                      <key-binding alias="&quot;The church rewards points for this product have been set to 0. I've notified the authorities.&quot;" key="From_0"/>
                      <key-binding alias="quickChurchRewardsError" key="To_0"/>
                      <key-binding alias="null" key="From_1"/>
                      <key-binding alias="null" key="To_1"/>
                      <key-binding alias="null" key="From_2"/>
                      <key-binding alias="null" key="To_2"/>
                      <key-binding alias="null" key="From_3"/>
                      <key-binding alias="null" key="To_3"/>
                      <key-binding alias="null" key="From_4"/>
                      <key-binding alias="null" key="To_4"/>
                      <key-binding alias="null" key="From_5"/>
                      <key-binding alias="null" key="To_5"/>
                      <key-binding alias="null" key="From_6"/>
                      <key-binding alias="null" key="To_6"/>
                      <key-binding alias="null" key="From_7"/>
                      <key-binding alias="null" key="To_7"/>
                      <key-binding alias="null" key="From_8"/>
                      <key-binding alias="null" key="To_8"/>
                      <key-binding alias="null" key="From_9"/>
                      <key-binding alias="null" key="To_9"/>
                    </pipelet-node>
                    <node-display orientation="horizontal" x="1" y="0"/>
                  </node>
                  <transition target-connector="in1" target-path="../../+3"/>
                </segment>
              </branch>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="1" y="0"/>
              </transition-display>
            </simple-transition>
            <node>
              <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="false"/>
                <key-binding alias="&quot;Only commanders may order redeemable product. Please log in as a commander to order this product.&quot;" key="From_0"/>
                <key-binding alias="quickChurchRewardsError" key="To_0"/>
                <key-binding alias="null" key="From_1"/>
                <key-binding alias="null" key="To_1"/>
                <key-binding alias="null" key="From_2"/>
                <key-binding alias="null" key="To_2"/>
                <key-binding alias="null" key="From_3"/>
                <key-binding alias="null" key="To_3"/>
                <key-binding alias="null" key="From_4"/>
                <key-binding alias="null" key="To_4"/>
                <key-binding alias="null" key="From_5"/>
                <key-binding alias="null" key="To_5"/>
                <key-binding alias="null" key="From_6"/>
                <key-binding alias="null" key="To_6"/>
                <key-binding alias="null" key="From_7"/>
                <key-binding alias="null" key="To_7"/>
                <key-binding alias="null" key="From_8"/>
                <key-binding alias="null" key="To_8"/>
                <key-binding alias="null" key="From_9"/>
                <key-binding alias="null" key="To_9"/>
              </pipelet-node>
              <node-display orientation="horizontal" x="1" y="0"/>
            </node>
            <transition target-connector="in1" target-path="../+2"/>
          </segment>
        </branch>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="3" y="0"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="2"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="-3" y="0"/>
      </node>
      <simple-transition/>
      <node>
        <decision-node condition-key="quickChurchRewardsError==null" condition-operator="expr"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="yes">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="0" y="1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <end-node name="ok"/>
              <node-display x="0" y="1"/>
            </node>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="2" y="0"/>
          <bend-point relative-to="target" x="0" y="-1"/>
        </transition-display>
      </simple-transition>
      <node>
        <end-node name="error"/>
        <node-display x="1" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_23">
    <segment>
      <node>
        <text-node>
          <description>Add product to mini cart. Renders a new mini cart and not a full cart.</description>
        </text-node>
        <node-display x="11" y="12"/>
      </node>
    </segment>
  </branch>
  <branch basename="MiniAddProduct">
    <segment>
      <node>
        <start-node name="MiniAddProduct" secure="false"/>
        <node-display x="11" y="13"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
          <bend-point relative-to="target" x="-1" y="0"/>
        </transition-display>
      </simple-transition>
      <node>
        <decision-node condition-key="CurrentHttpParameterMap.ProductListID.stringValue" condition-operator="expr"/>
        <node-display orientation="horizontal" x="0" y="1"/>
        <branch basename="b2" source-connector="yes">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="1" y="0"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <call-node start-name-ref="Cart-HandleProductListItem"/>
              <node-display orientation="horizontal" x="1" y="0"/>
            </node>
            <transition target-connector="in1" target-path="../+1"/>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <decision-node condition-key="CurrentHttpParameterMap.pid.stringValue" condition-operator="expr"/>
        <node-display x="0" y="1"/>
        <branch basename="b3" source-connector="yes">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="0" y="1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="false"/>
                <key-binding alias="ProductQuantity" key="To_0"/>
                <key-binding alias="CurrentHttpParameterMap.pid.stringValue" key="From_1"/>
                <key-binding alias="ProductID" key="To_1"/>
                <key-binding alias="'MiniAddProduct'" key="From_2"/>
                <key-binding alias="ProductSource" key="To_2"/>
                <key-binding alias="null" key="From_3"/>
                <key-binding alias="null" key="To_3"/>
                <key-binding alias="null" key="From_4"/>
                <key-binding alias="null" key="To_4"/>
                <key-binding alias="null" key="From_5"/>
                <key-binding alias="null" key="To_5"/>
                <key-binding alias="null" key="From_6"/>
                <key-binding alias="null" key="To_6"/>
                <key-binding alias="null" key="From_7"/>
                <key-binding alias="null" key="To_7"/>
                <key-binding alias="null" key="From_8"/>
                <key-binding alias="null" key="To_8"/>
                <key-binding alias="null" key="From_9"/>
                <key-binding alias="null" key="To_9"/>
                <key-binding alias="CurrentHttpParameterMap.Quantity.doubleValue" key="From_0"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <call-node start-name-ref="Cart-CheckQuantity"/>
              <node-display x="0" y="1"/>
              <branch basename="b2" source-connector="error">
                <transition target-connector="in1" target-path="../+2"/>
              </branch>
              <branch basename="b3" source-connector="ok">
                <transition target-connector="in"/>
                <segment>
                  <node>
                    <pipelet-node pipelet-name="GetProduct" pipelet-set-identifier="bc_api">
                      <key-binding alias="Product" key="Product"/>
                      <key-binding alias="CurrentHttpParameterMap.pid.stringValue" key="ProductID"/>
                    </pipelet-node>
                    <node-display x="0" y="1"/>
                    <branch basename="b2" source-connector="error">
                      <transition target-connector="in1" target-path="../../+3"/>
                    </branch>
                  </node>
                  <simple-transition>
                    <transition-display>
                      <bend-point relative-to="source" x="0" y="1"/>
                    </transition-display>
                  </simple-transition>
                  <node>
                    <decision-node condition-key="!empty(Product.ID) &amp;&amp; Product.ID != dw.system.Site.getCurrent().getCustomPreferenceValue('NonTraditionalRegistrationProductCode') || !empty(Product.ID) &amp;&amp; Product.ID != dw.system.Site.getCurrent().getCustomPreferenceValue('NonTraditionalRegistrationProductCodeFull')" condition-operator="expr"/>
                    <node-display x="0" y="1"/>
                    <branch basename="b3" source-connector="yes">
                      <transition target-connector="in"/>
                      <segment>
                        <node>
                          <decision-node condition-key="!empty(Product.custom.ProductType) &amp;&amp; Product.custom.ProductType=='RewardsRedeemable' &amp;&amp; dw.system.Site.getCurrent().getCustomPreferenceValue('ChurchRewardsProgramActive')" condition-operator="expr"/>
                          <node-display x="0" y="1"/>
                          <branch basename="b2" source-connector="yes">
                            <transition target-connector="in"/>
                            <segment>
                              <node>
                                <decision-node condition-key="!empty(CurrentCustomer.profile) &amp;&amp; CurrentCustomer.profile.custom.CustomerType == 'Commander'" condition-operator="expr"/>
                                <node-display x="0" y="1"/>
                                <branch basename="b2" source-connector="yes">
                                  <transition target-connector="in">
                                    <transition-display>
                                      <bend-point relative-to="source" x="0" y="1"/>
                                    </transition-display>
                                  </transition>
                                  <segment>
                                    <node>
                                      <decision-node condition-key="!empty(CurrentCustomer.profile.custom.ChurchRewardsChurchPointsAvailable) &amp;&amp; !empty(Product.custom.ChurchRewardsPointsCategory) &amp;&amp; CurrentCustomer.profile.custom.ChurchRewardsChurchPointsAvailable&gt;=(Product.custom.ChurchRewardsPointsCategory*CurrentHttpParameterMap.Quantity.value)" condition-operator="expr"/>
                                      <node-display x="0" y="1"/>
                                      <branch basename="b2" source-connector="yes">
                                        <transition target-connector="in">
                                          <transition-display>
                                            <bend-point relative-to="source" x="0" y="1"/>
                                          </transition-display>
                                        </transition>
                                        <segment>
                                          <node>
                                            <decision-node condition-key="!empty(Product.custom.ChurchRewardsPointsCategory) &amp;&amp; Product.custom.ChurchRewardsPointsCategory&gt;0" condition-operator="expr"/>
                                            <node-display x="0" y="1"/>
                                            <branch basename="b2" source-connector="yes">
                                              <transition target-connector="in">
                                                <transition-display>
                                                  <bend-point relative-to="source" x="0" y="1"/>
                                                </transition-display>
                                              </transition>
                                              <segment>
                                                <node>
                                                  <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                                                    <config-property key="Transactional" value="true"/>
                                                    <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsChurchPointsAvailable-(Product.custom.ChurchRewardsPointsCategory*CurrentHttpParameterMap.Quantity)" key="From_0"/>
                                                    <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsChurchPointsAvailable" key="To_0"/>
                                                    <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsPointsInCart-(Product.custom.ChurchRewardsPointsCategory*CurrentHttpParameterMap.Quantity)" key="From_1"/>
                                                    <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsPointsInCart" key="To_1"/>
                                                    <key-binding alias="null" key="From_2"/>
                                                    <key-binding alias="null" key="To_2"/>
                                                    <key-binding alias="null" key="From_3"/>
                                                    <key-binding alias="null" key="To_3"/>
                                                    <key-binding alias="null" key="From_4"/>
                                                    <key-binding alias="null" key="To_4"/>
                                                    <key-binding alias="null" key="From_5"/>
                                                    <key-binding alias="null" key="To_5"/>
                                                    <key-binding alias="null" key="From_6"/>
                                                    <key-binding alias="null" key="To_6"/>
                                                    <key-binding alias="null" key="From_7"/>
                                                    <key-binding alias="null" key="To_7"/>
                                                    <key-binding alias="null" key="From_8"/>
                                                    <key-binding alias="null" key="To_8"/>
                                                    <key-binding alias="null" key="From_9"/>
                                                    <key-binding alias="null" key="To_9"/>
                                                  </pipelet-node>
                                                  <node-display x="0" y="1"/>
                                                </node>
                                                <transition target-connector="in1" target-path="../../../../+3"/>
                                              </segment>
                                            </branch>
                                          </node>
                                          <simple-transition>
                                            <transition-display>
                                              <bend-point relative-to="source" x="1" y="0"/>
                                            </transition-display>
                                          </simple-transition>
                                          <node>
                                            <pipelet-node pipelet-name="SendMail" pipelet-set-identifier="bc_api">
                                              <key-binding alias="&quot;donotreply@awana.org&quot;" key="MailFrom"/>
                                              <key-binding alias="&quot;jasonp@awana.org&quot;" key="MailTo"/>
                                              <key-binding alias="&quot;Demandware Site Error&quot;" key="MailSubject"/>
                                              <key-binding alias="null" key="LocaleID"/>
                                              <key-binding alias="null" key="MailCC"/>
                                              <key-binding alias="null" key="MailBCC"/>
                                              <key-binding alias="&quot;mail/nopointcategory&quot;" key="MailTemplate"/>
                                            </pipelet-node>
                                            <node-display orientation="horizontal" x="1" y="0"/>
                                          </node>
                                          <simple-transition>
                                            <transition-display>
                                              <bend-point relative-to="source" x="1" y="0"/>
                                              <bend-point relative-to="source" x="1" y="1"/>
                                              <bend-point relative-to="source" x="0" y="1"/>
                                            </transition-display>
                                          </simple-transition>
                                          <node>
                                            <interaction-node transaction-required="false">
                                              <template buffered="true" dynamic="false" name="product/components/displayNoPointCategory"/>
                                            </interaction-node>
                                            <node-display x="0" y="1"/>
                                          </node>
                                        </segment>
                                      </branch>
                                    </node>
                                    <simple-transition>
                                      <transition-display>
                                        <bend-point relative-to="source" x="1" y="0"/>
                                      </transition-display>
                                    </simple-transition>
                                    <node>
                                      <interaction-node transaction-required="false">
                                        <template buffered="true" dynamic="false" name="product/components/displayNotEnoughPoints"/>
                                      </interaction-node>
                                      <node-display orientation="horizontal" x="1" y="0"/>
                                    </node>
                                  </segment>
                                </branch>
                              </node>
                              <simple-transition>
                                <transition-display>
                                  <bend-point relative-to="source" x="1" y="0"/>
                                </transition-display>
                              </simple-transition>
                              <node>
                                <interaction-node transaction-required="false">
                                  <template buffered="true" dynamic="false" name="product/components/displayNotEligible"/>
                                </interaction-node>
                                <node-display orientation="horizontal" x="1" y="0"/>
                              </node>
                            </segment>
                          </branch>
                        </node>
                        <transition target-connector="in1" target-path="./+1"/>
                      </segment>
                      <segment>
                        <node>
                          <join-node/>
                          <node-display x="2" y="0"/>
                        </node>
                        <transition target-connector="in1" target-path="./+1"/>
                      </segment>
                      <segment>
                        <node>
                          <join-node/>
                          <node-display x="0" y="5"/>
                        </node>
                        <transition target-connector="in1" target-path="./+1"/>
                      </segment>
                      <segment>
                        <node>
                          <join-node/>
                          <node-display x="-2" y="0"/>
                        </node>
                        <simple-transition>
                          <transition-display>
                            <bend-point relative-to="source" x="0" y="2"/>
                            <bend-point relative-to="target" x="-1" y="0"/>
                          </transition-display>
                        </simple-transition>
                        <node>
                          <decision-node condition-key="Product.productSet" condition-operator="expr"/>
                          <node-display orientation="horizontal" x="0" y="2"/>
                          <branch basename="b2" source-connector="yes">
                            <transition target-connector="in">
                              <transition-display>
                                <bend-point relative-to="source" x="2" y="0"/>
                              </transition-display>
                            </transition>
                            <segment>
                              <node>
                                <call-node start-name-ref="Cart-AddProductSetProducts"/>
                                <node-display x="1" y="1"/>
                              </node>
                              <transition target-connector="in1" target-path="../+1"/>
                            </segment>
                          </branch>
                        </node>
                        <simple-transition>
                          <transition-display>
                            <bend-point relative-to="source" x="0" y="1"/>
                          </transition-display>
                        </simple-transition>
                        <node>
                          <pipelet-node pipelet-name="UpdateProductOptionSelections" pipelet-set-identifier="bc_api"/>
                          <node-display x="0" y="1"/>
                        </node>
                        <simple-transition>
                          <transition-display>
                            <bend-point relative-to="source" x="0" y="1"/>
                          </transition-display>
                        </simple-transition>
                        <node>
                          <pipelet-node pipelet-name="AddProductToBasket" pipelet-set-identifier="bc_api">
                            <key-binding alias="Basket" key="Basket"/>
                            <key-binding alias="Product" key="Product"/>
                            <key-binding alias="ProductOptionModel" key="ProductOptionModel"/>
                            <key-binding alias="CurrentHttpParameterMap.Quantity.doubleValue" key="Quantity"/>
                            <key-binding alias="null" key="Shipment"/>
                            <key-binding alias="ProductLineItem" key="ProductLineItem"/>
                            <key-binding alias="dw.catalog.CatalogMgr.getCategory(CurrentHttpParameterMap.cgid.value)" key="Category"/>
                          </pipelet-node>
                          <node-display x="0" y="1"/>
                          <branch basename="b3" source-connector="error">
                            <transition target-connector="in2" target-path="../../../+5"/>
                          </branch>
                        </node>
                        <simple-transition>
                          <transition-display>
                            <bend-point relative-to="source" x="0" y="1"/>
                          </transition-display>
                        </simple-transition>
                        <node>
                          <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                            <config-property key="Transactional" value="true"/>
                            <key-binding alias="CurrentHttpParameterMap.RegistrationNumber.stringValue" key="From_0"/>
                            <key-binding alias="ProductLineItem.externalLineItemText" key="To_0"/>
                            <key-binding alias="null" key="From_1"/>
                            <key-binding alias="null" key="To_1"/>
                            <key-binding alias="null" key="From_2"/>
                            <key-binding alias="null" key="To_2"/>
                            <key-binding alias="null" key="From_3"/>
                            <key-binding alias="null" key="To_3"/>
                            <key-binding alias="null" key="From_4"/>
                            <key-binding alias="null" key="To_4"/>
                            <key-binding alias="null" key="From_5"/>
                            <key-binding alias="null" key="To_5"/>
                            <key-binding alias="null" key="From_6"/>
                            <key-binding alias="null" key="To_6"/>
                            <key-binding alias="null" key="From_7"/>
                            <key-binding alias="null" key="To_7"/>
                            <key-binding alias="null" key="From_8"/>
                            <key-binding alias="null" key="To_8"/>
                            <key-binding alias="null" key="From_9"/>
                            <key-binding alias="null" key="To_9"/>
                          </pipelet-node>
                          <node-display x="0" y="1"/>
                        </node>
                        <simple-transition>
                          <transition-display>
                            <bend-point relative-to="source" x="0" y="1"/>
                          </transition-display>
                        </simple-transition>
                        <node>
                          <decision-node condition-key="Product.bundle" condition-operator="expr"/>
                          <node-display x="0" y="1"/>
                          <branch basename="b4" source-connector="yes">
                            <transition target-connector="in">
                              <transition-display>
                                <bend-point relative-to="source" x="0" y="1"/>
                              </transition-display>
                            </transition>
                            <segment>
                              <node>
                                <call-node start-name-ref="Cart-ReplaceBundleLineItemProducts"/>
                                <node-display x="0" y="1"/>
                              </node>
                              <transition target-connector="in1" target-path="../+2"/>
                            </segment>
                          </branch>
                        </node>
                        <transition target-connector="in2" target-path="./+1"/>
                      </segment>
                      <segment>
                        <node>
                          <join-node/>
                          <node-display x="1" y="0"/>
                        </node>
                        <transition target-connector="in1" target-path="./+1"/>
                      </segment>
                      <segment>
                        <node>
                          <join-node/>
                          <node-display x="0" y="2"/>
                        </node>
                        <simple-transition/>
                        <node>
                          <call-node start-name-ref="Cart-Calculate"/>
                          <node-display x="0" y="1"/>
                        </node>
                        <transition target-connector="in1" target-path="../../../+6"/>
                      </segment>
                    </branch>
                  </node>
                  <simple-transition>
                    <transition-display>
                      <bend-point relative-to="source" x="1" y="0"/>
                    </transition-display>
                  </simple-transition>
                  <node>
                    <interaction-node transaction-required="false">
                      <template buffered="true" dynamic="false" name="product/components/displayProductCannotBeAdded"/>
                    </interaction-node>
                    <node-display orientation="horizontal" x="1" y="0"/>
                  </node>
                </segment>
              </branch>
            </node>
          </segment>
        </branch>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="4" y="0"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="2"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="8"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="3"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="6"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <interaction-node transaction-required="false">
          <template buffered="true" dynamic="false" name="checkout/cart/minicart"/>
        </interaction-node>
        <node-display x="0" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_25">
    <segment>
      <node>
        <text-node>
          <description>Adds multiple products to the basket. Uses multiple product IDs separated by comma.</description>
        </text-node>
        <node-display x="16" y="12"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_26">
    <segment>
      <node>
        <text-node>
          <description>Adds the product with the given ID to the wish list.</description>
        </text-node>
        <node-display x="19" y="12"/>
      </node>
    </segment>
  </branch>
  <branch basename="AddProductSetProducts">
    <segment>
      <node>
        <start-node call-mode="private" name="AddProductSetProducts" secure="false"/>
        <node-display x="16" y="13"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
          <config-property key="Transactional" value="false"/>
          <key-binding alias="CurrentHttpParameterMap.childPids.stringValue.split(&quot;,&quot;)" key="From_0"/>
          <key-binding alias="childPids" key="To_0"/>
          <key-binding alias="CurrentHttpParameterMap.Quantity.stringValue.split(&quot;,&quot;)" key="From_1"/>
          <key-binding alias="childQtys" key="To_1"/>
          <key-binding alias="0" key="From_2"/>
          <key-binding alias="counter" key="To_2"/>
          <key-binding alias="null" key="From_3"/>
          <key-binding alias="null" key="To_3"/>
          <key-binding alias="null" key="From_4"/>
          <key-binding alias="null" key="To_4"/>
          <key-binding alias="null" key="From_5"/>
          <key-binding alias="null" key="To_5"/>
          <key-binding alias="null" key="From_6"/>
          <key-binding alias="null" key="To_6"/>
          <key-binding alias="null" key="From_7"/>
          <key-binding alias="null" key="To_7"/>
          <key-binding alias="null" key="From_8"/>
          <key-binding alias="null" key="To_8"/>
          <key-binding alias="null" key="From_9"/>
          <key-binding alias="null" key="To_9"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <loop-node element-key="childPid" iterator-key="childPids"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="do">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="0" y="1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <pipelet-node pipelet-name="GetProduct" pipelet-set-identifier="bc_api">
                <key-binding alias="ChildProduct" key="Product"/>
                <key-binding alias="childPid" key="ProductID"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
              <branch basename="b2" source-connector="error">
                <transition target-connector="in1" target-path="./+1">
                  <transition-display>
                    <bend-point relative-to="source" x="1" y="0"/>
                    <bend-point relative-to="source" x="3" y="3"/>
                    <bend-point relative-to="target" x="1" y="0"/>
                  </transition-display>
                </transition>
              </branch>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <pipelet-node pipelet-name="UpdateProductOptionSelections" pipelet-set-identifier="bc_api"/>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition/>
            <node>
              <pipelet-node pipelet-name="AddProductToBasket" pipelet-set-identifier="bc_api">
                <key-binding alias="Basket" key="Basket"/>
                <key-binding alias="ChildProduct" key="Product"/>
                <key-binding alias="ChildProductOptionModel" key="ProductOptionModel"/>
                <key-binding alias="parseInt(childQtys[counter])" key="Quantity"/>
                <key-binding alias="null" key="Shipment"/>
                <key-binding alias="ProductLineItem" key="ProductLineItem"/>
                <key-binding alias="dw.catalog.CatalogMgr.getCategory(CurrentHttpParameterMap.cgid.value)" key="Category"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
              <branch basename="b3" source-connector="error">
                <transition target-connector="in1" target-path="./+1">
                  <transition-display>
                    <bend-point relative-to="source" x="1" y="0"/>
                  </transition-display>
                </transition>
              </branch>
            </node>
            <transition target-connector="in1" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="false"/>
                <key-binding alias="counter + 1" key="From_0"/>
                <key-binding alias="counter" key="To_0"/>
                <key-binding alias="null" key="From_1"/>
                <key-binding alias="null" key="To_1"/>
                <key-binding alias="null" key="From_2"/>
                <key-binding alias="null" key="To_2"/>
                <key-binding alias="null" key="From_3"/>
                <key-binding alias="null" key="To_3"/>
                <key-binding alias="null" key="From_4"/>
                <key-binding alias="null" key="To_4"/>
                <key-binding alias="null" key="From_5"/>
                <key-binding alias="null" key="To_5"/>
                <key-binding alias="null" key="From_6"/>
                <key-binding alias="null" key="To_6"/>
                <key-binding alias="null" key="From_7"/>
                <key-binding alias="null" key="To_7"/>
                <key-binding alias="null" key="From_8"/>
                <key-binding alias="null" key="To_8"/>
                <key-binding alias="null" key="From_9"/>
                <key-binding alias="null" key="To_9"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
            </node>
            <transition target-connector="loop" target-path="..">
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
                <bend-point relative-to="source" x="-1" y="1"/>
                <bend-point relative-to="target" x="-1" y="0"/>
              </transition-display>
            </transition>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="1" y="0"/>
        </transition-display>
      </simple-transition>
      <node>
        <end-node/>
        <node-display orientation="horizontal" x="1" y="0"/>
      </node>
    </segment>
  </branch>
  <branch basename="AddToWishlist">
    <segment>
      <node>
        <start-node name="AddToWishlist" secure="false"/>
        <node-display x="19" y="13"/>
      </node>
      <simple-transition/>
      <node>
        <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
          <config-property key="Transactional" value="false"/>
          <key-binding alias="empty(ProductID) ? CurrentHttpParameterMap.pid.stringValue : ProductID" key="From_0"/>
          <key-binding alias="ProductID" key="To_0"/>
          <key-binding alias="null" key="From_1"/>
          <key-binding alias="ProductAddedToWishlist" key="To_1"/>
          <key-binding alias="null" key="From_2"/>
          <key-binding alias="null" key="To_2"/>
          <key-binding alias="null" key="From_3"/>
          <key-binding alias="null" key="To_3"/>
          <key-binding alias="null" key="From_4"/>
          <key-binding alias="null" key="To_4"/>
          <key-binding alias="null" key="From_5"/>
          <key-binding alias="null" key="To_5"/>
          <key-binding alias="null" key="From_6"/>
          <key-binding alias="null" key="To_6"/>
          <key-binding alias="null" key="From_7"/>
          <key-binding alias="null" key="To_7"/>
          <key-binding alias="null" key="From_8"/>
          <key-binding alias="null" key="To_8"/>
          <key-binding alias="null" key="From_9"/>
          <key-binding alias="null" key="To_9"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
      </node>
      <simple-transition/>
      <node>
        <call-node start-name-ref="Wishlist-AddProduct"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="error">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="target" x="0" y="-1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="false"/>
                <key-binding alias="null" key="From_0"/>
                <key-binding alias="ProductAddedToWishlist" key="To_0"/>
                <key-binding alias="null" key="From_1"/>
                <key-binding alias="null" key="To_1"/>
                <key-binding alias="null" key="From_2"/>
                <key-binding alias="null" key="To_2"/>
                <key-binding alias="null" key="From_3"/>
                <key-binding alias="null" key="To_3"/>
                <key-binding alias="null" key="From_4"/>
                <key-binding alias="null" key="To_4"/>
                <key-binding alias="null" key="From_5"/>
                <key-binding alias="null" key="To_5"/>
                <key-binding alias="null" key="From_6"/>
                <key-binding alias="null" key="To_6"/>
                <key-binding alias="null" key="From_7"/>
                <key-binding alias="null" key="To_7"/>
                <key-binding alias="null" key="From_8"/>
                <key-binding alias="null" key="To_8"/>
                <key-binding alias="null" key="From_9"/>
                <key-binding alias="null" key="To_9"/>
              </pipelet-node>
              <node-display x="1" y="1"/>
            </node>
            <transition target-connector="in1" target-path="./+1">
              <transition-display>
                <bend-point relative-to="source" x="0" y="2"/>
              </transition-display>
            </transition>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="-1" y="1"/>
            </node>
            <simple-transition/>
            <node>
              <jump-node start-name-ref="Cart-Show"/>
              <node-display x="0" y="1"/>
            </node>
          </segment>
        </branch>
        <branch basename="b3" source-connector="ok">
          <transition target-connector="in"/>
          <segment>
            <node>
              <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="false"/>
                <key-binding alias="ProductID" key="From_0"/>
                <key-binding alias="ProductAddedToWishlist" key="To_0"/>
                <key-binding alias="null" key="From_1"/>
                <key-binding alias="null" key="To_1"/>
                <key-binding alias="null" key="From_2"/>
                <key-binding alias="null" key="To_2"/>
                <key-binding alias="null" key="From_3"/>
                <key-binding alias="null" key="To_3"/>
                <key-binding alias="null" key="From_4"/>
                <key-binding alias="null" key="To_4"/>
                <key-binding alias="null" key="From_5"/>
                <key-binding alias="null" key="To_5"/>
                <key-binding alias="null" key="From_6"/>
                <key-binding alias="null" key="To_6"/>
                <key-binding alias="null" key="From_7"/>
                <key-binding alias="null" key="To_7"/>
                <key-binding alias="null" key="From_8"/>
                <key-binding alias="null" key="To_8"/>
                <key-binding alias="null" key="From_9"/>
                <key-binding alias="null" key="To_9"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
            </node>
            <transition target-connector="in1" target-path="../b2.2"/>
          </segment>
        </branch>
      </node>
    </segment>
  </branch>
  <branch basename="QuickAfterUpdateChurchRewardsPoints">
    <segment>
      <node>
        <start-node call-mode="private" name="QuickAfterUpdateChurchRewardsPoints" secure="false"/>
        <node-display x="30" y="19"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
          <config-property key="Transactional" value="false"/>
          <key-binding alias="null" key="From_0"/>
          <key-binding alias="quickChurchRewardsError" key="To_0"/>
          <key-binding alias="null" key="From_1"/>
          <key-binding alias="null" key="To_1"/>
          <key-binding alias="null" key="From_2"/>
          <key-binding alias="null" key="To_2"/>
          <key-binding alias="null" key="From_3"/>
          <key-binding alias="null" key="To_3"/>
          <key-binding alias="null" key="From_4"/>
          <key-binding alias="null" key="To_4"/>
          <key-binding alias="null" key="From_5"/>
          <key-binding alias="null" key="To_5"/>
          <key-binding alias="null" key="From_6"/>
          <key-binding alias="null" key="To_6"/>
          <key-binding alias="null" key="From_7"/>
          <key-binding alias="null" key="To_7"/>
          <key-binding alias="null" key="From_8"/>
          <key-binding alias="null" key="To_8"/>
          <key-binding alias="null" key="From_9"/>
          <key-binding alias="null" key="To_9"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <decision-node condition-key="!empty(CurrentCustomer.profile) &amp;&amp; CurrentCustomer.profile.custom.IsChurchRewardsSponsor &amp;&amp; dw.system.Site.getCurrent().getCustomPreferenceValue('ChurchRewardsProgramActive') || !empty(CurrentCustomer.profile) &amp;&amp; CurrentCustomer.profile.custom.CustomerType=='Commander' &amp;&amp; dw.system.Site.getCurrent().getCustomPreferenceValue('ChurchRewardsProgramActive')" condition-operator="expr"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="yes">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="0" y="1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <call-node start-name-ref="Cart-GetQualifyingChurchRewardsPointsInCart"/>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <call-node start-name-ref="Cart-GetRedeemableChurchRewardsPointsInCart"/>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="2"/>
                <bend-point relative-to="target" x="0" y="-1"/>
              </transition-display>
            </simple-transition>
            <node>
              <decision-node condition-key="!empty(CurrentCustomer.profile) &amp;&amp; CurrentCustomer.profile.custom.IsChurchRewardsSponsor" condition-operator="expr"/>
              <node-display x="-1" y="2"/>
              <branch basename="b2" source-connector="yes">
                <transition target-connector="in"/>
                <segment>
                  <node>
                    <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                      <config-property key="Transactional" value="true"/>
                      <key-binding alias="totalQualifyingPointsInCart+totalRedeemablePointsInCart" key="From_0"/>
                      <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsPointsInCart" key="To_0"/>
                      <key-binding alias="null" key="From_2"/>
                      <key-binding alias="null" key="To_2"/>
                      <key-binding alias="null" key="From_3"/>
                      <key-binding alias="null" key="To_3"/>
                      <key-binding alias="null" key="From_4"/>
                      <key-binding alias="null" key="To_4"/>
                      <key-binding alias="null" key="From_5"/>
                      <key-binding alias="null" key="To_5"/>
                      <key-binding alias="null" key="From_6"/>
                      <key-binding alias="null" key="To_6"/>
                      <key-binding alias="null" key="From_7"/>
                      <key-binding alias="null" key="To_7"/>
                      <key-binding alias="null" key="From_8"/>
                      <key-binding alias="null" key="To_8"/>
                      <key-binding alias="null" key="From_9"/>
                      <key-binding alias="null" key="To_9"/>
                    </pipelet-node>
                    <node-display x="0" y="1"/>
                  </node>
                  <transition target-connector="in1" target-path="../../+7"/>
                </segment>
              </branch>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="1" y="0"/>
              </transition-display>
            </simple-transition>
            <node>
              <decision-node condition-key="!empty(CurrentCustomer.profile) &amp;&amp; CurrentCustomer.profile.custom.CustomerType=='Commander'" condition-operator="expr"/>
              <node-display orientation="horizontal" x="1" y="0"/>
              <branch basename="b3" source-connector="yes">
                <transition target-connector="in">
                  <transition-display>
                    <bend-point relative-to="target" x="0" y="-2"/>
                    <bend-point relative-to="target" x="0" y="-1"/>
                  </transition-display>
                </transition>
                <segment>
                  <node>
                    <loop-node element-key="b" iterator-key="Basket.allProductLineItems"/>
                    <node-display x="3" y="1"/>
                    <branch basename="b2" source-connector="do">
                      <transition target-connector="in">
                        <transition-display>
                          <bend-point relative-to="source" x="0" y="1"/>
                        </transition-display>
                      </transition>
                      <segment>
                        <node>
                          <loop-node element-key="c" iterator-key="CurrentForms.cart.shipments.i0.items.i0"/>
                          <node-display x="0" y="1"/>
                          <branch basename="b2" source-connector="do">
                            <transition target-connector="in">
                              <transition-display>
                                <bend-point relative-to="source" x="0" y="1"/>
                              </transition-display>
                            </transition>
                            <segment>
                              <node>
                                <decision-node condition-key="c.productID==b.productID &amp;&amp; c.quantity&gt;b.quantity" condition-operator="expr"/>
                                <node-display x="0" y="1"/>
                                <branch basename="b2" source-connector="yes">
                                  <transition target-connector="in">
                                    <transition-display>
                                      <bend-point relative-to="source" x="0" y="1"/>
                                    </transition-display>
                                  </transition>
                                  <segment>
                                    <node>
                                      <decision-node condition-key="!empty(c.custom.ProductType) &amp;&amp; c.custom.ProductType=='RewardsRedeemable'" condition-operator="expr"/>
                                      <node-display x="0" y="1"/>
                                      <branch basename="b2" source-connector="yes">
                                        <transition target-connector="in">
                                          <transition-display>
                                            <bend-point relative-to="source" x="0" y="1"/>
                                          </transition-display>
                                        </transition>
                                        <segment>
                                          <node>
                                            <decision-node condition-key="!empty(c.custom.ChurchRewardsPointsCategory) &amp;&amp; c.custom.ChurchRewardsPointsCategory&gt;0" condition-operator="expr"/>
                                            <node-display x="0" y="1"/>
                                            <branch basename="b2" source-connector="yes">
                                              <transition target-connector="in">
                                                <transition-display>
                                                  <bend-point relative-to="source" x="0" y="1"/>
                                                </transition-display>
                                              </transition>
                                              <segment>
                                                <node>
                                                  <decision-node condition-key="CurrentCustomer.profile.custom.ChurchRewardsChurchPointsAvailable&gt;(c.custom.ChurchRewardsPointsCategory*c.quantity)" condition-operator="expr"/>
                                                  <node-display x="0" y="1"/>
                                                  <branch basename="b2" source-connector="yes">
                                                    <transition target-connector="in">
                                                      <transition-display>
                                                        <bend-point relative-to="source" x="0" y="1"/>
                                                      </transition-display>
                                                    </transition>
                                                    <segment>
                                                      <node>
                                                        <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                                                          <config-property key="Transactional" value="true"/>
                                                          <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsChurchPointsAvailable-(c.custom.ChurchRewardsPointsCategory*quickAddQty)" key="From_0"/>
                                                          <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsChurchPointsAvailable" key="To_0"/>
                                                          <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsPointsInCart-(c.custom.ChurchRewardsPointsCategory*quickAddQty)" key="From_1"/>
                                                          <key-binding alias="CurrentCustomer.profile.custom.ChurchRewardsPointsInCart" key="To_1"/>
                                                          <key-binding alias="null" key="From_2"/>
                                                          <key-binding alias="null" key="To_2"/>
                                                          <key-binding alias="null" key="From_3"/>
                                                          <key-binding alias="null" key="To_3"/>
                                                          <key-binding alias="null" key="From_4"/>
                                                          <key-binding alias="null" key="To_4"/>
                                                          <key-binding alias="null" key="From_5"/>
                                                          <key-binding alias="null" key="To_5"/>
                                                          <key-binding alias="null" key="From_6"/>
                                                          <key-binding alias="null" key="To_6"/>
                                                          <key-binding alias="null" key="From_7"/>
                                                          <key-binding alias="null" key="To_7"/>
                                                          <key-binding alias="null" key="From_8"/>
                                                          <key-binding alias="null" key="To_8"/>
                                                          <key-binding alias="null" key="From_9"/>
                                                          <key-binding alias="null" key="To_9"/>
                                                        </pipelet-node>
                                                        <node-display x="0" y="1"/>
                                                      </node>
                                                      <transition target-connector="in1" target-path="../../../../+6"/>
                                                    </segment>
                                                  </branch>
                                                </node>
                                                <simple-transition>
                                                  <transition-display>
                                                    <bend-point relative-to="source" x="1" y="0"/>
                                                  </transition-display>
                                                </simple-transition>
                                                <node>
                                                  <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                                                    <config-property key="Transactional" value="false"/>
                                                    <key-binding alias="&quot;Your church does not have enough points to purchase that many of this product.&quot;" key="From_0"/>
                                                    <key-binding alias="quickChurchRewardsError" key="To_0"/>
                                                    <key-binding alias="null" key="To_1"/>
                                                    <key-binding alias="null" key="From_2"/>
                                                    <key-binding alias="null" key="To_2"/>
                                                    <key-binding alias="null" key="From_3"/>
                                                    <key-binding alias="null" key="To_3"/>
                                                    <key-binding alias="null" key="From_4"/>
                                                    <key-binding alias="null" key="To_4"/>
                                                    <key-binding alias="null" key="From_5"/>
                                                    <key-binding alias="null" key="To_5"/>
                                                    <key-binding alias="null" key="From_6"/>
                                                    <key-binding alias="null" key="To_6"/>
                                                    <key-binding alias="null" key="From_7"/>
                                                    <key-binding alias="null" key="To_7"/>
                                                    <key-binding alias="null" key="From_8"/>
                                                    <key-binding alias="null" key="To_8"/>
                                                    <key-binding alias="null" key="From_9"/>
                                                    <key-binding alias="null" key="To_9"/>
                                                  </pipelet-node>
                                                  <node-display orientation="horizontal" x="1" y="0"/>
                                                </node>
                                                <transition target-connector="in1" target-path="../../../+4"/>
                                              </segment>
                                            </branch>
                                          </node>
                                          <simple-transition>
                                            <transition-display>
                                              <bend-point relative-to="source" x="1" y="0"/>
                                            </transition-display>
                                          </simple-transition>
                                          <node>
                                            <pipelet-node pipelet-name="SendMail" pipelet-set-identifier="bc_api">
                                              <key-binding alias="&quot;store@awana.org&quot;" key="MailFrom"/>
                                              <key-binding alias="&quot;mail/nopointcategory.isml&quot;" key="MailTemplate"/>
                                              <key-binding alias="&quot;jasonp@awana.org&quot;" key="MailTo"/>
                                              <key-binding alias="&quot;Redeemable Product Has Zero Price In Demandware&quot;" key="MailSubject"/>
                                              <key-binding alias="null" key="LocaleID"/>
                                              <key-binding alias="null" key="MailCC"/>
                                              <key-binding alias="null" key="MailBCC"/>
                                            </pipelet-node>
                                            <node-display orientation="horizontal" x="1" y="0"/>
                                          </node>
                                          <simple-transition>
                                            <transition-display>
                                              <bend-point relative-to="source" x="1" y="0"/>
                                            </transition-display>
                                          </simple-transition>
                                          <node>
                                            <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                                              <config-property key="Transactional" value="false"/>
                                              <key-binding alias="&quot;The church rewards points for this product have been set to 0. I've notified the authorities.&quot;" key="From_0"/>
                                              <key-binding alias="quickChurchRewardsError" key="To_0"/>
                                              <key-binding alias="null" key="From_1"/>
                                              <key-binding alias="null" key="To_1"/>
                                              <key-binding alias="null" key="From_2"/>
                                              <key-binding alias="null" key="To_2"/>
                                              <key-binding alias="null" key="From_3"/>
                                              <key-binding alias="null" key="To_3"/>
                                              <key-binding alias="null" key="From_4"/>
                                              <key-binding alias="null" key="To_4"/>
                                              <key-binding alias="null" key="From_5"/>
                                              <key-binding alias="null" key="To_5"/>
                                              <key-binding alias="null" key="From_6"/>
                                              <key-binding alias="null" key="To_6"/>
                                              <key-binding alias="null" key="From_7"/>
                                              <key-binding alias="null" key="To_7"/>
                                              <key-binding alias="null" key="From_8"/>
                                              <key-binding alias="null" key="To_8"/>
                                              <key-binding alias="null" key="From_9"/>
                                              <key-binding alias="null" key="To_9"/>
                                            </pipelet-node>
                                            <node-display orientation="horizontal" x="1" y="0"/>
                                          </node>
                                          <transition target-connector="in1" target-path="../../+3"/>
                                        </segment>
                                      </branch>
                                    </node>
                                    <transition target-connector="in1" target-path="../+2"/>
                                  </segment>
                                </branch>
                              </node>
                              <transition target-connector="in1" target-path="./+1"/>
                            </segment>
                            <segment>
                              <node>
                                <join-node/>
                                <node-display x="3" y="0"/>
                              </node>
                              <transition target-connector="in1" target-path="./+1"/>
                            </segment>
                            <segment>
                              <node>
                                <join-node/>
                                <node-display x="0" y="1"/>
                              </node>
                              <transition target-connector="in1" target-path="./+1"/>
                            </segment>
                            <segment>
                              <node>
                                <join-node/>
                                <node-display x="0" y="1"/>
                              </node>
                              <transition target-connector="in1" target-path="./+1"/>
                            </segment>
                            <segment>
                              <node>
                                <join-node/>
                                <node-display x="0" y="1"/>
                              </node>
                              <transition target-connector="in1" target-path="./+1"/>
                            </segment>
                            <segment>
                              <node>
                                <join-node/>
                                <node-display x="0" y="2"/>
                              </node>
                              <transition target-connector="in1" target-path="./+1"/>
                            </segment>
                            <segment>
                              <node>
                                <join-node/>
                                <node-display x="-3" y="0"/>
                              </node>
                              <transition target-connector="in1" target-path="./+1"/>
                            </segment>
                            <segment>
                              <node>
                                <join-node/>
                                <node-display x="-1" y="0"/>
                              </node>
                              <transition target-connector="in1" target-path="./+1"/>
                            </segment>
                            <segment>
                              <node>
                                <join-node/>
                                <node-display x="0" y="-6"/>
                              </node>
                              <transition target-connector="loop" target-path=".."/>
                            </segment>
                          </branch>
                        </node>
                        <transition target-connector="in1" target-path="./+1"/>
                      </segment>
                      <segment>
                        <node>
                          <join-node/>
                          <node-display x="4" y="0"/>
                        </node>
                        <transition target-connector="in1" target-path="./+1"/>
                      </segment>
                      <segment>
                        <node>
                          <join-node/>
                          <node-display x="0" y="7"/>
                        </node>
                        <transition target-connector="in1" target-path="./+1"/>
                      </segment>
                      <segment>
                        <node>
                          <join-node/>
                          <node-display x="-6" y="0"/>
                        </node>
                        <transition target-connector="in1" target-path="./+1"/>
                      </segment>
                      <segment>
                        <node>
                          <join-node/>
                          <node-display x="0" y="-8"/>
                        </node>
                        <transition target-connector="loop" target-path="..">
                          <transition-display>
                            <bend-point relative-to="target" x="-1" y="0"/>
                          </transition-display>
                        </transition>
                      </segment>
                    </branch>
                  </node>
                  <transition target-connector="in1" target-path="../../+3"/>
                </segment>
              </branch>
            </node>
            <transition target-connector="in1" target-path="../+6"/>
          </segment>
        </branch>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="8" y="0"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="4"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="1"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="9"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="-8" y="0"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="-8"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="-1" y="0"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <decision-node condition-key="quickChurchRewardsError==null" condition-operator="expr"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="yes">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="target" x="0" y="-1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <end-node name="ok"/>
              <node-display x="-1" y="1"/>
            </node>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="1" y="0"/>
          <bend-point relative-to="source" x="1" y="1"/>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <end-node name="error"/>
        <node-display x="0" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="QuickBeforeUpdateChurchRewardsPoints">
    <segment>
      <node>
        <start-node call-mode="private" name="QuickBeforeUpdateChurchRewardsPoints" secure="false"/>
        <node-display x="42" y="19"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <decision-node condition-key="!empty(CurrentCustomer.profile) &amp;&amp; CurrentCustomer.profile.custom.CustomerType=='Commander' &amp;&amp; dw.system.Site.getCurrent().getCustomPreferenceValue('ChurchRewardsProgramActive')" condition-operator="expr"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="yes">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="0" y="1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <pipelet-node pipelet-name="Script" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="false"/>
                <config-property key="OnError" value="PIPELET_ERROR"/>
                <config-property key="ScriptFile" value="cart/RecordAllProductLineItems.ds"/>
                <key-binding alias="null" key="ScriptLog"/>
                <key-binding alias="Basket.allProductLineItems" key="ProductLineItems"/>
                <key-binding alias="beforePLI" key="RedeemableLineItems"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
            </node>
            <transition target-connector="in1" target-path="../+3"/>
          </segment>
        </branch>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="1" y="0"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="2"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="-1" y="0"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <end-node name="ok"/>
        <node-display x="0" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_31">
    <segment>
      <node>
        <text-node>
          <description>Remove PayPal PI.</description>
        </text-node>
        <node-display x="26" y="22"/>
      </node>
    </segment>
  </branch>
  <branch basename="CleanPayPalPI">
    <segment>
      <node>
        <start-node call-mode="private" name="CleanPayPalPI" secure="false"/>
        <node-display x="26" y="23"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <decision-node condition-key="Basket.paymentInstrument !=null &amp;&amp; Basket.paymentInstrument.paymentMethod.equals(&quot;PayPal&quot;)" condition-operator="expr"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="yes">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="0" y="1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <call-node start-name-ref="Paypal-RemovePayPalPI"/>
              <node-display x="0" y="1"/>
            </node>
            <transition target-connector="in1" target-path="../+1"/>
          </segment>
        </branch>
      </node>
      <transition target-connector="in1" target-path="./+1">
        <transition-display>
          <bend-point relative-to="source" x="1" y="0"/>
          <bend-point relative-to="target" x="1" y="0"/>
        </transition-display>
      </transition>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="2"/>
      </node>
      <simple-transition/>
      <node>
        <end-node/>
        <node-display x="0" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_33">
    <segment>
      <node>
        <text-node>
          <description>If the user is logged in successfully, take it to the checkout page.</description>
        </text-node>
        <node-display x="1" y="25"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_34">
    <segment>
      <node>
        <text-node>
          <description>Login and present the user refreshed cart with any changes e.g. user specific promotions etc.</description>
        </text-node>
        <node-display x="3" y="27"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_35">
    <segment>
      <node>
        <text-node>
          <description>Handles ProductListItem Add to cart from gift registry or wish list page.</description>
        </text-node>
        <node-display x="19" y="24"/>
      </node>
    </segment>
  </branch>
  <branch basename="HandleProductListItem">
    <segment>
      <node>
        <start-node call-mode="private" name="HandleProductListItem" secure="false"/>
        <node-display x="19" y="25"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <call-node start-name-ref="ProductList-Init"/>
        <node-display x="0" y="1"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <call-node start-name-ref="Cart-GetBasket"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="error">
          <transition target-connector="in1" target-path="./+2"/>
        </branch>
      </node>
      <simple-transition/>
      <node>
        <pipelet-node pipelet-name="AddProductToBasket" pipelet-set-identifier="bc_api">
          <key-binding alias="Basket" key="Basket"/>
          <key-binding alias="ProductOptionModel" key="ProductOptionModel"/>
          <key-binding alias="CurrentHttpParameterMap.Quantity.doubleValue" key="Quantity"/>
          <key-binding alias="null" key="Shipment"/>
          <key-binding alias="ProductLineItem" key="ProductLineItem"/>
          <key-binding alias="dw.catalog.CatalogMgr.getCategory(CurrentHttpParameterMap.cgid.value)" key="Category"/>
          <key-binding alias="ProductListItem" key="ProductListItem"/>
        </pipelet-node>
        <node-display orientation="horizontal" x="1" y="1"/>
        <branch basename="b3" source-connector="error">
          <transition target-connector="in1" target-path="./+1"/>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="2" y="0"/>
        </transition-display>
      </simple-transition>
      <node>
        <call-node start-name-ref="Cart-Calculate"/>
        <node-display x="1" y="1"/>
      </node>
      <transition target-connector="in1" target-path="./+1">
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
          <bend-point relative-to="source" x="-1" y="1"/>
        </transition-display>
      </transition>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="-1" y="0"/>
      </node>
      <transition target-connector="in3" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="-1" y="0"/>
      </node>
      <simple-transition/>
      <node>
        <end-node/>
        <node-display x="0" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_37">
    <segment>
      <node>
        <text-node>
          <description>Inserts the Wish List into the pipeline dictionary if the customer is authenticated.</description>
        </text-node>
        <node-display x="22" y="25"/>
      </node>
    </segment>
  </branch>
  <branch basename="FetchWishList">
    <segment>
      <node>
        <start-node call-mode="private" name="FetchWishList" secure="false"/>
        <node-display x="22" y="26"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <decision-node condition-key="CurrentCustomer.authenticated" condition-operator="expr"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="yes">
          <transition target-connector="in"/>
          <segment>
            <node>
              <call-node start-name-ref="Wishlist-FetchWishList"/>
              <node-display x="0" y="1"/>
            </node>
            <transition target-connector="in1" target-path="../+1"/>
          </segment>
        </branch>
      </node>
      <transition target-connector="in1" target-path="./+1">
        <transition-display>
          <bend-point relative-to="source" x="1" y="0"/>
          <bend-point relative-to="target" x="1" y="0"/>
        </transition-display>
      </transition>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="2"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <end-node/>
        <node-display x="0" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_39">
    <segment>
      <node>
        <text-node>
          <description>Determines an existing basket from the current session. If a basket wasn't found, the pipeline ends in a named end node &quot;error&quot;. This node can be used in other pipelines such as the checkout pipelines in order to access the basket. This pipeline does not create a new basket. Calling pipelines are responsible to properly react on the &quot;error&quot; end node.</description>
        </text-node>
        <node-display width="3" x="1" y="28"/>
      </node>
    </segment>
  </branch>
  <branch basename="GetExistingBasket">
    <segment>
      <node>
        <start-node call-mode="private" name="GetExistingBasket" secure="false"/>
        <node-display x="1" y="29"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="target" x="-1" y="0"/>
        </transition-display>
      </simple-transition>
      <node>
        <decision-node condition-key="Basket != null" condition-operator="expr"/>
        <node-display orientation="horizontal" x="0" y="1"/>
        <branch basename="b2" source-connector="yes">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="1" y="0"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <end-node/>
              <node-display orientation="horizontal" x="1" y="0"/>
            </node>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <pipelet-node pipelet-name="GetBasket" pipelet-set-identifier="bc_api">
          <config-property key="Create" value="false"/>
          <key-binding alias="Basket" key="Basket"/>
          <key-binding alias="StoredBasket" key="StoredBasket"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
        <branch basename="b3" source-connector="error">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="1" y="0"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <end-node name="error"/>
              <node-display orientation="horizontal" x="1" y="0"/>
            </node>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <end-node/>
        <node-display x="0" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_41">
    <segment>
      <node>
        <text-node>
          <description>Determines an existing basket from the current session. If a basket wasn't found, a new basket is created. If a new basket couldn't be created, the pipeline ends in a named end node &quot;error&quot;. Calling pipelines are responsible to properly react on the &quot;error&quot; end node.</description>
        </text-node>
        <node-display width="2" x="5" y="28"/>
      </node>
    </segment>
  </branch>
  <branch basename="GetBasket">
    <segment>
      <node>
        <start-node call-mode="private" name="GetBasket" secure="false"/>
        <node-display x="5" y="29"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="target" x="-1" y="0"/>
        </transition-display>
      </simple-transition>
      <node>
        <decision-node condition-key="Basket != null" condition-operator="expr"/>
        <node-display orientation="horizontal" x="0" y="1"/>
        <branch basename="b2" source-connector="yes">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="1" y="0"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <end-node/>
              <node-display orientation="horizontal" x="1" y="0"/>
            </node>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <pipelet-node pipelet-name="GetBasket" pipelet-set-identifier="bc_api">
          <config-property key="Create" value="true"/>
          <key-binding alias="Basket" key="Basket"/>
          <key-binding alias="StoredBasket" key="StoredBasket"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
        <branch basename="b3" source-connector="error">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="1" y="0"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <end-node name="error"/>
              <node-display orientation="horizontal" x="1" y="0"/>
            </node>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <end-node/>
        <node-display x="0" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_43">
    <segment>
      <node>
        <text-node>
          <description>Calculates an existing basket. Call this pipeline always if the changes to the basket content is made (e.g. addition or removal of a product or gift certificate or setting of a shipping method).</description>
        </text-node>
        <node-display width="2" x="8" y="28"/>
      </node>
    </segment>
  </branch>
  <branch basename="Calculate">
    <segment>
      <node>
        <start-node call-mode="private" name="Calculate" secure="false"/>
        <node-display x="8" y="29"/>
      </node>
      <simple-transition/>
      <node>
        <call-node start-name-ref="Cart-GetExistingBasket"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="error">
          <transition target-connector="in1" target-path="./b3.1">
            <transition-display>
              <bend-point relative-to="target" x="0" y="-1"/>
            </transition-display>
          </transition>
        </branch>
      </node>
      <simple-transition/>
      <node>
        <pipelet-node pipelet-name="Script" pipelet-set-identifier="bc_api">
          <config-property key="ScriptFile" value="cart/CalculateCart.ds"/>
          <config-property key="Transactional" value="true"/>
          <config-property key="Timeout" value="dw.system.Site.getCurrent().getCustomPreferenceValue('WebServiceTimeout')"/>
          <key-binding alias="ScriptLog" key="ScriptLog"/>
          <key-binding alias="Basket" key="Basket"/>
          <key-binding alias="CalcTax" key="calcTax"/>
          <key-binding alias="778" key="donationAmount"/>
          <key-binding alias="CallingPipeline" key="CallingPipeline"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
        <branch basename="b3" source-connector="error">
          <transition target-connector="in2"/>
          <segment>
            <node>
              <join-node/>
              <node-display x="1" y="0"/>
            </node>
            <simple-transition/>
            <node>
              <end-node/>
              <node-display x="0" y="1"/>
            </node>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <end-node/>
        <node-display x="0" y="1"/>
      </node>
    </segment>
  </branch>
  <branch basename="CheckQuantity">
    <segment>
      <node>
        <start-node call-mode="private" name="CheckQuantity" secure="false"/>
        <node-display x="1" y="34"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <call-node start-name-ref="Cart-GetBasket"/>
        <node-display x="0" y="1"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <decision-node condition-key="!empty(Basket)" condition-operator="expr"/>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="yes">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="0" y="1"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="false"/>
                <key-binding alias="0" key="From_0"/>
                <key-binding alias="LineItemQuantity" key="To_0"/>
                <key-binding alias="null" key="From_1"/>
                <key-binding alias="null" key="To_1"/>
                <key-binding alias="null" key="From_2"/>
                <key-binding alias="null" key="To_2"/>
                <key-binding alias="null" key="From_3"/>
                <key-binding alias="null" key="To_3"/>
                <key-binding alias="null" key="From_4"/>
                <key-binding alias="null" key="To_4"/>
                <key-binding alias="null" key="From_5"/>
                <key-binding alias="null" key="To_5"/>
                <key-binding alias="null" key="From_6"/>
                <key-binding alias="null" key="To_6"/>
                <key-binding alias="null" key="From_7"/>
                <key-binding alias="null" key="To_7"/>
                <key-binding alias="null" key="From_8"/>
                <key-binding alias="null" key="To_8"/>
                <key-binding alias="null" key="From_9"/>
                <key-binding alias="null" key="To_9"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <pipelet-node pipelet-name="Script" pipelet-set-identifier="bc_api">
                <config-property key="Transactional" value="false"/>
                <config-property key="OnError" value="PIPELET_ERROR"/>
                <config-property key="ScriptFile" value="product/GetProductLineItemFromBasket.ds"/>
                <key-binding alias="null" key="ScriptLog"/>
                <key-binding alias="Basket" key="Basket"/>
                <key-binding alias="ProductID" key="ProductNumber"/>
                <key-binding alias="LineItem" key="BasketLineItem"/>
                <key-binding alias="Basket" key="BasketObject"/>
              </pipelet-node>
              <node-display x="0" y="1"/>
              <branch basename="b2" source-connector="error">
                <transition target-connector="in1"/>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="2" y="0"/>
                  </node>
                  <transition target-connector="in1" target-path="../+2/b2.2"/>
                </segment>
              </branch>
            </node>
            <simple-transition>
              <transition-display>
                <bend-point relative-to="source" x="0" y="1"/>
              </transition-display>
            </simple-transition>
            <node>
              <decision-node condition-key="!empty(LineItem)" condition-operator="expr"/>
              <node-display x="0" y="1"/>
              <branch basename="b3" source-connector="yes">
                <transition target-connector="in">
                  <transition-display>
                    <bend-point relative-to="source" x="0" y="1"/>
                  </transition-display>
                </transition>
                <segment>
                  <node>
                    <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                      <config-property key="Transactional" value="false"/>
                      <key-binding alias="LineItem.quantityValue" key="From_0"/>
                      <key-binding alias="LineItemQuantity" key="To_0"/>
                      <key-binding alias="null" key="From_1"/>
                      <key-binding alias="null" key="To_1"/>
                      <key-binding alias="null" key="From_2"/>
                      <key-binding alias="null" key="To_2"/>
                      <key-binding alias="null" key="From_3"/>
                      <key-binding alias="null" key="To_3"/>
                      <key-binding alias="null" key="From_4"/>
                      <key-binding alias="null" key="To_4"/>
                      <key-binding alias="null" key="From_5"/>
                      <key-binding alias="null" key="To_5"/>
                      <key-binding alias="null" key="From_6"/>
                      <key-binding alias="null" key="To_6"/>
                      <key-binding alias="null" key="From_7"/>
                      <key-binding alias="null" key="To_7"/>
                      <key-binding alias="null" key="From_8"/>
                      <key-binding alias="null" key="To_8"/>
                      <key-binding alias="null" key="From_9"/>
                      <key-binding alias="null" key="To_9"/>
                    </pipelet-node>
                    <node-display x="0" y="1"/>
                  </node>
                  <transition target-connector="in1" target-path="../+2"/>
                </segment>
              </branch>
            </node>
            <transition target-connector="in1" target-path="./+1"/>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="1" y="0"/>
            </node>
            <transition target-connector="in1" target-path="./+1">
              <transition-display>
                <bend-point relative-to="source" x="0" y="2"/>
                <bend-point relative-to="target" x="2" y="0"/>
              </transition-display>
            </transition>
          </segment>
          <segment>
            <node>
              <join-node/>
              <node-display x="-1" y="2"/>
            </node>
            <simple-transition/>
            <node>
              <decision-node condition-key="(Number(ProductQuantity)+Number(LineItemQuantity))&gt;=1000" condition-operator="expr"/>
              <node-display x="0" y="1"/>
              <branch basename="b2" source-connector="yes">
                <transition target-connector="in">
                  <transition-display>
                    <bend-point relative-to="source" x="0" y="1"/>
                  </transition-display>
                </transition>
                <segment>
                  <node>
                    <pipelet-node pipelet-name="Assign" pipelet-set-identifier="bc_api">
                      <config-property key="Transactional" value="false"/>
                      <key-binding alias="dw.web.Resource.msg('displayproducterror.qtylimitexceeded','product',null)" key="From_0"/>
                      <key-binding alias="ProductErrorMessage" key="To_0"/>
                      <key-binding alias="dw.web.Resource.msg('displayproducterror.qtylimitexceeded','product',null)" key="From_1"/>
                      <key-binding alias="quickAddStatus" key="To_1"/>
                      <key-binding alias="null" key="From_2"/>
                      <key-binding alias="null" key="To_2"/>
                      <key-binding alias="null" key="From_3"/>
                      <key-binding alias="null" key="To_3"/>
                      <key-binding alias="null" key="From_4"/>
                      <key-binding alias="null" key="To_4"/>
                      <key-binding alias="null" key="From_5"/>
                      <key-binding alias="null" key="To_5"/>
                      <key-binding alias="null" key="From_6"/>
                      <key-binding alias="null" key="To_6"/>
                      <key-binding alias="null" key="From_7"/>
                      <key-binding alias="null" key="To_7"/>
                      <key-binding alias="null" key="From_8"/>
                      <key-binding alias="null" key="To_8"/>
                      <key-binding alias="null" key="From_9"/>
                      <key-binding alias="null" key="To_9"/>
                    </pipelet-node>
                    <node-display x="0" y="1"/>
                  </node>
                  <simple-transition>
                    <transition-display>
                      <bend-point relative-to="source" x="0" y="1"/>
                    </transition-display>
                  </simple-transition>
                  <node>
                    <decision-node condition-key="!empty(ProductSource) &amp;&amp; ProductSource=='MiniAddProduct'" condition-operator="expr"/>
                    <node-display x="0" y="1"/>
                    <branch basename="b2" source-connector="yes">
                      <transition target-connector="in">
                        <transition-display>
                          <bend-point relative-to="source" x="0" y="1"/>
                        </transition-display>
                      </transition>
                      <segment>
                        <node>
                          <interaction-node transaction-required="false">
                            <template buffered="true" dynamic="false" name="product/components/displayProductError"/>
                          </interaction-node>
                          <node-display x="0" y="1"/>
                        </node>
                      </segment>
                    </branch>
                  </node>
                  <transition target-connector="in1" target-path="./+1"/>
                </segment>
                <segment>
                  <node>
                    <join-node/>
                    <node-display x="2" y="0"/>
                  </node>
                  <simple-transition/>
                  <node>
                    <end-node name="error"/>
                    <node-display x="0" y="1"/>
                  </node>
                </segment>
              </branch>
            </node>
            <transition target-connector="in1" target-path="../+2"/>
          </segment>
        </branch>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="3" y="0"/>
      </node>
      <transition target-connector="in1" target-path="./+1"/>
    </segment>
    <segment>
      <node>
        <join-node/>
        <node-display x="0" y="6"/>
      </node>
      <simple-transition/>
      <node>
        <end-node name="ok"/>
        <node-display x="0" y="3"/>
      </node>
    </segment>
  </branch>
  <branch basename="_ANONYMOUS_BRANCH_46">
    <segment>
      <node>
        <text-node>
          <description>Start the checkout process.</description>
        </text-node>
        <node-display x="5" y="34"/>
      </node>
    </segment>
  </branch>
  <branch basename="COStart">
    <segment>
      <node>
        <start-node call-mode="private" name="COStart" secure="false"/>
        <node-display x="6" y="34"/>
      </node>
      <simple-transition/>
      <node>
        <call-node start-name-ref="Cart-Calculate"/>
        <node-display x="0" y="1"/>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <pipelet-node custom-name="Validates the basket against additional conditions" pipelet-name="Script" pipelet-set-identifier="bc_api">
          <config-property key="ScriptFile" value="cart/ValidateCartForCheckout.ds"/>
          <config-property key="Transactional" value="false"/>
          <config-property key="Timeout" value="dw.system.Site.getCurrent().getCustomPreferenceValue('WebServiceTimeout')"/>
          <key-binding alias="null" key="ScriptLog"/>
          <key-binding alias="Basket" key="Basket"/>
          <key-binding alias="BasketStatus" key="BasketStatus"/>
          <key-binding alias="CurrentCustomer.profile.custom.AccountOnHold" key="AccountOnHold"/>
        </pipelet-node>
        <node-display x="0" y="1"/>
        <branch basename="b2" source-connector="error">
          <transition target-connector="in">
            <transition-display>
              <bend-point relative-to="source" x="1" y="0"/>
            </transition-display>
          </transition>
          <segment>
            <node>
              <end-node name="error"/>
              <node-display orientation="horizontal" x="1" y="0"/>
            </node>
          </segment>
        </branch>
      </node>
      <simple-transition>
        <transition-display>
          <bend-point relative-to="source" x="0" y="1"/>
        </transition-display>
      </simple-transition>
      <node>
        <jump-node start-name-ref="COCustomer-Start"/>
        <node-display x="0" y="1"/>
      </node>
    </segment>
  </branch>
</pipeline>
